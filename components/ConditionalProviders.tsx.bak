'use client';

import { usePathname } from 'next/navigation';
import { Suspense } from 'react';
import { Providers } from '@/components/Providers';
import NavbarProvider from '@/components/NavbarProvider';
import { PersistentMusicProvider } from '@/hooks/usePersistentMusic';
import PlayButtonOverlay from '@/components/PlayButtonOverlay';
import Footer from '@/components/Footer';
import { YoursWalletProvider } from '@/lib/context/YoursWalletContext';
import { ThemeProvider } from '@/components/ThemeProvider';
import { ColorThemeProvider } from '@/components/ThemePicker';

// Routes that should skip wallet/music providers but keep navbar
const LIGHT_ROUTES = ['/studio', '/video/editor'];

export default function ConditionalProviders({
  children,
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();

  // Check if current route should use lighter providers
  const isLightRoute = LIGHT_ROUTES.some(route => pathname?.startsWith(route));

  // Light layout - keeps navbar but skips wallet/music
  if (isLightRoute) {
    return (
      <Providers>
        <ThemeProvider>
          <ColorThemeProvider>
            <NavbarProvider>
              <div className="flex flex-col min-h-screen">
                <main className="flex-grow">{children}</main>
              </div>
            </NavbarProvider>
          </ColorThemeProvider>
        </ThemeProvider>
      </Providers>
    );
  }

  // Full layout with all providers
  return (
    <YoursWalletProvider>
      <Providers>
        <Suspense fallback={null}>
          <ThemeProvider>
            <ColorThemeProvider>
              <PersistentMusicProvider>
                <NavbarProvider>
                  <div className="flex flex-col min-h-screen">
                    <main className="flex-grow">{children}</main>
                    <Footer />
                  </div>
                  <PlayButtonOverlay />
                </NavbarProvider>
              </PersistentMusicProvider>
            </ColorThemeProvider>
          </ThemeProvider>
        </Suspense>
      </Providers>
    </YoursWalletProvider>
  );
}
