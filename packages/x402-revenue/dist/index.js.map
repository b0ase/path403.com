{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/x402-revenue\n *\n * HTTP 402 Payment Required protocol for monetizing web content.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Payment method */\nexport type PaymentMethod = 'bsv' | 'lightning' | 'handcash' | 'paymail' | 'stripe';\n\n/** Payment status */\nexport type PaymentStatus = 'pending' | 'confirmed' | 'failed' | 'expired';\n\n/** Price model */\nexport type PriceModel = 'fixed' | 'per-request' | 'time-based' | 'streaming' | 'subscription';\n\n/** Payment request */\nexport interface PaymentRequest {\n  id: string;\n  resource: string;\n  amount: number;\n  currency: string;\n  methods: PaymentMethod[];\n  priceModel: PriceModel;\n  expiresAt: number;\n  description?: string;\n  metadata?: Record<string, unknown>;\n  paymentDetails: PaymentDetails;\n}\n\n/** Payment details for each method */\nexport interface PaymentDetails {\n  bsv?: {\n    address: string;\n    script?: string;\n  };\n  lightning?: {\n    invoice: string;\n    nodeId?: string;\n  };\n  handcash?: {\n    handle: string;\n    paymentId: string;\n  };\n  paymail?: {\n    address: string;\n  };\n  stripe?: {\n    sessionId: string;\n    url: string;\n  };\n}\n\n/** Payment receipt */\nexport interface PaymentReceipt {\n  id: string;\n  requestId: string;\n  method: PaymentMethod;\n  amount: number;\n  currency: string;\n  txid?: string;\n  paidAt: number;\n  validUntil?: number;\n}\n\n/** Access token */\nexport interface AccessToken {\n  token: string;\n  resource: string;\n  issuedAt: number;\n  expiresAt: number;\n  usageLimit?: number;\n  usageCount: number;\n}\n\n/** 402 Response headers */\nexport interface X402Headers {\n  'X-Payment-Required': 'true';\n  'X-Payment-Methods': string;\n  'X-Payment-Amount': string;\n  'X-Payment-Currency': string;\n  'X-Payment-Address'?: string;\n  'X-Payment-Invoice'?: string;\n  'X-Payment-Description'?: string;\n  'X-Payment-Expires'?: string;\n  'X-Payment-Request-Id': string;\n}\n\n/** Resource pricing config */\nexport interface PricingConfig {\n  amount: number;\n  currency: string;\n  model: PriceModel;\n  methods: PaymentMethod[];\n  duration?: number; // For time-based access\n  requestLimit?: number; // For per-request model\n  description?: string;\n}\n\n/** Revenue stats */\nexport interface RevenueStats {\n  totalRevenue: number;\n  transactionCount: number;\n  uniquePayers: number;\n  byMethod: Record<PaymentMethod, number>;\n  byResource: Record<string, number>;\n  period: { start: number; end: number };\n}\n\n/** Manager options */\nexport interface X402Options {\n  defaultMethods?: PaymentMethod[];\n  defaultCurrency?: string;\n  requestExpiry?: number;\n  tokenExpiry?: number;\n  onPaymentReceived?: (receipt: PaymentReceipt) => void;\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nexport const HTTP_402_STATUS = 402;\nexport const DEFAULT_EXPIRY = 3600000; // 1 hour\nexport const DEFAULT_CURRENCY = 'USD';\n\n// ============================================================================\n// X402 Revenue Manager\n// ============================================================================\n\nexport class X402RevenueManager {\n  private options: Required<X402Options>;\n  private requests: Map<string, PaymentRequest> = new Map();\n  private receipts: Map<string, PaymentReceipt> = new Map();\n  private tokens: Map<string, AccessToken> = new Map();\n  private pricing: Map<string, PricingConfig> = new Map();\n\n  constructor(options: X402Options = {}) {\n    this.options = {\n      defaultMethods: options.defaultMethods || ['bsv', 'handcash'],\n      defaultCurrency: options.defaultCurrency || DEFAULT_CURRENCY,\n      requestExpiry: options.requestExpiry || DEFAULT_EXPIRY,\n      tokenExpiry: options.tokenExpiry || DEFAULT_EXPIRY * 24,\n      onPaymentReceived: options.onPaymentReceived || (() => {}),\n    };\n  }\n\n  // ==========================================================================\n  // Resource Pricing\n  // ==========================================================================\n\n  setResourcePrice(resource: string, config: PricingConfig): void {\n    this.pricing.set(resource, config);\n  }\n\n  getResourcePrice(resource: string): PricingConfig | undefined {\n    // Check exact match\n    if (this.pricing.has(resource)) {\n      return this.pricing.get(resource);\n    }\n\n    // Check wildcard patterns\n    for (const [pattern, config] of this.pricing) {\n      if (this.matchPattern(resource, pattern)) {\n        return config;\n      }\n    }\n\n    return undefined;\n  }\n\n  removeResourcePrice(resource: string): boolean {\n    return this.pricing.delete(resource);\n  }\n\n  private matchPattern(resource: string, pattern: string): boolean {\n    if (!pattern.includes('*')) return resource === pattern;\n\n    const regex = new RegExp('^' + pattern.replace(/\\*/g, '.*') + '$');\n    return regex.test(resource);\n  }\n\n  // ==========================================================================\n  // Payment Requests\n  // ==========================================================================\n\n  createPaymentRequest(resource: string, paymentDetails: PaymentDetails): PaymentRequest {\n    const config = this.getResourcePrice(resource);\n    if (!config) {\n      throw new Error(`No pricing configured for resource: ${resource}`);\n    }\n\n    const id = this.generateId('req');\n    const request: PaymentRequest = {\n      id,\n      resource,\n      amount: config.amount,\n      currency: config.currency,\n      methods: config.methods,\n      priceModel: config.model,\n      expiresAt: Date.now() + this.options.requestExpiry,\n      description: config.description,\n      paymentDetails,\n    };\n\n    this.requests.set(id, request);\n    return request;\n  }\n\n  getPaymentRequest(id: string): PaymentRequest | undefined {\n    return this.requests.get(id);\n  }\n\n  isRequestValid(id: string): boolean {\n    const request = this.requests.get(id);\n    if (!request) return false;\n    return Date.now() < request.expiresAt;\n  }\n\n  // ==========================================================================\n  // Payment Verification\n  // ==========================================================================\n\n  async verifyPayment(\n    requestId: string,\n    method: PaymentMethod,\n    proof: { txid?: string; signature?: string }\n  ): Promise<PaymentReceipt | null> {\n    const request = this.requests.get(requestId);\n    if (!request) return null;\n\n    if (!this.isRequestValid(requestId)) return null;\n\n    // In production, verify the actual payment on-chain or via API\n    // For now, assume valid if proof is provided\n    if (!proof.txid && !proof.signature) return null;\n\n    const receipt: PaymentReceipt = {\n      id: this.generateId('rcpt'),\n      requestId,\n      method,\n      amount: request.amount,\n      currency: request.currency,\n      txid: proof.txid,\n      paidAt: Date.now(),\n      validUntil: request.priceModel === 'time-based'\n        ? Date.now() + (this.getResourcePrice(request.resource)?.duration || DEFAULT_EXPIRY)\n        : undefined,\n    };\n\n    this.receipts.set(receipt.id, receipt);\n    this.options.onPaymentReceived(receipt);\n\n    return receipt;\n  }\n\n  getReceipt(id: string): PaymentReceipt | undefined {\n    return this.receipts.get(id);\n  }\n\n  // ==========================================================================\n  // Access Tokens\n  // ==========================================================================\n\n  createAccessToken(receipt: PaymentReceipt): AccessToken {\n    const request = this.requests.get(receipt.requestId);\n    if (!request) {\n      throw new Error('Invalid receipt');\n    }\n\n    const config = this.getResourcePrice(request.resource);\n    const token: AccessToken = {\n      token: this.generateToken(),\n      resource: request.resource,\n      issuedAt: Date.now(),\n      expiresAt: receipt.validUntil || Date.now() + this.options.tokenExpiry,\n      usageLimit: config?.requestLimit,\n      usageCount: 0,\n    };\n\n    this.tokens.set(token.token, token);\n    return token;\n  }\n\n  validateToken(token: string, resource: string): boolean {\n    const accessToken = this.tokens.get(token);\n    if (!accessToken) return false;\n\n    if (Date.now() > accessToken.expiresAt) {\n      this.tokens.delete(token);\n      return false;\n    }\n\n    if (!this.matchPattern(resource, accessToken.resource)) {\n      return false;\n    }\n\n    if (accessToken.usageLimit && accessToken.usageCount >= accessToken.usageLimit) {\n      return false;\n    }\n\n    accessToken.usageCount++;\n    return true;\n  }\n\n  revokeToken(token: string): boolean {\n    return this.tokens.delete(token);\n  }\n\n  // ==========================================================================\n  // HTTP Response Helpers\n  // ==========================================================================\n\n  create402Response(resource: string, paymentDetails: PaymentDetails): {\n    status: 402;\n    headers: X402Headers;\n    body: PaymentRequest;\n  } {\n    const request = this.createPaymentRequest(resource, paymentDetails);\n\n    const headers: X402Headers = {\n      'X-Payment-Required': 'true',\n      'X-Payment-Methods': request.methods.join(','),\n      'X-Payment-Amount': request.amount.toString(),\n      'X-Payment-Currency': request.currency,\n      'X-Payment-Request-Id': request.id,\n    };\n\n    if (paymentDetails.bsv?.address) {\n      headers['X-Payment-Address'] = paymentDetails.bsv.address;\n    }\n\n    if (paymentDetails.lightning?.invoice) {\n      headers['X-Payment-Invoice'] = paymentDetails.lightning.invoice;\n    }\n\n    if (request.description) {\n      headers['X-Payment-Description'] = request.description;\n    }\n\n    headers['X-Payment-Expires'] = new Date(request.expiresAt).toISOString();\n\n    return {\n      status: HTTP_402_STATUS,\n      headers,\n      body: request,\n    };\n  }\n\n  parsePaymentHeader(authorization: string): { token?: string; receipt?: string } | null {\n    if (!authorization) return null;\n\n    if (authorization.startsWith('X402-Token ')) {\n      return { token: authorization.slice(11) };\n    }\n\n    if (authorization.startsWith('X402-Receipt ')) {\n      return { receipt: authorization.slice(13) };\n    }\n\n    return null;\n  }\n\n  // ==========================================================================\n  // Analytics\n  // ==========================================================================\n\n  getRevenueStats(startTime?: number, endTime?: number): RevenueStats {\n    const start = startTime || 0;\n    const end = endTime || Date.now();\n\n    const receipts = Array.from(this.receipts.values()).filter(\n      (r) => r.paidAt >= start && r.paidAt <= end\n    );\n\n    const byMethod: Record<PaymentMethod, number> = {\n      bsv: 0,\n      lightning: 0,\n      handcash: 0,\n      paymail: 0,\n      stripe: 0,\n    };\n\n    const byResource: Record<string, number> = {};\n    const payers = new Set<string>();\n\n    for (const receipt of receipts) {\n      byMethod[receipt.method] += receipt.amount;\n\n      const request = this.requests.get(receipt.requestId);\n      if (request) {\n        byResource[request.resource] = (byResource[request.resource] || 0) + receipt.amount;\n      }\n\n      if (receipt.txid) {\n        payers.add(receipt.txid.slice(0, 20)); // Approximate unique payers\n      }\n    }\n\n    return {\n      totalRevenue: receipts.reduce((sum, r) => sum + r.amount, 0),\n      transactionCount: receipts.length,\n      uniquePayers: payers.size,\n      byMethod,\n      byResource,\n      period: { start, end },\n    };\n  }\n\n  // ==========================================================================\n  // Utilities\n  // ==========================================================================\n\n  private generateId(prefix: string): string {\n    return `${prefix}_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\n  }\n\n  private generateToken(): string {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let token = '';\n    for (let i = 0; i < 64; i++) {\n      token += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return token;\n  }\n\n  cleanup(): void {\n    const now = Date.now();\n\n    for (const [id, request] of this.requests) {\n      if (now > request.expiresAt) {\n        this.requests.delete(id);\n      }\n    }\n\n    for (const [token, accessToken] of this.tokens) {\n      if (now > accessToken.expiresAt) {\n        this.tokens.delete(token);\n      }\n    }\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\nexport function createX402Manager(options?: X402Options): X402RevenueManager {\n  return new X402RevenueManager(options);\n}\n\n// ============================================================================\n// Middleware Helpers\n// ============================================================================\n\n/**\n * Create middleware for 402 protection\n */\nexport function createPaywall(\n  manager: X402RevenueManager,\n  getPaymentDetails: (resource: string) => PaymentDetails\n): (resource: string, token?: string) => { allowed: boolean; response?: ReturnType<X402RevenueManager['create402Response']> } {\n  return (resource: string, token?: string) => {\n    if (token && manager.validateToken(token, resource)) {\n      return { allowed: true };\n    }\n\n    const pricing = manager.getResourcePrice(resource);\n    if (!pricing) {\n      return { allowed: true }; // No pricing = free access\n    }\n\n    const paymentDetails = getPaymentDetails(resource);\n    return {\n      allowed: false,\n      response: manager.create402Response(resource, paymentDetails),\n    };\n  };\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Format price for display\n */\nexport function formatPrice(amount: number, currency: string): string {\n  if (currency === 'sats' || currency === 'SAT') {\n    return `${amount} sats`;\n  }\n\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currency.toUpperCase(),\n  }).format(amount / 100);\n}\n\n/**\n * Convert between currencies (simplified)\n */\nexport function convertCurrency(\n  amount: number,\n  from: string,\n  to: string,\n  rates: Record<string, number>\n): number {\n  const fromRate = rates[from.toUpperCase()] || 1;\n  const toRate = rates[to.toUpperCase()] || 1;\n  return (amount / fromRate) * toRate;\n}\n"],"mappings":"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","names":[]}