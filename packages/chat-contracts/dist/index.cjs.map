{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/chat-contracts\n *\n * Chat payment contracts and message monetization utilities.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Payment model */\nexport type PaymentModel =\n  | 'per-message'\n  | 'per-word'\n  | 'per-character'\n  | 'per-minute'\n  | 'subscription'\n  | 'tip'\n  | 'unlock';\n\n/** Contract status */\nexport type ContractStatus =\n  | 'draft'\n  | 'pending'\n  | 'active'\n  | 'paused'\n  | 'completed'\n  | 'expired'\n  | 'cancelled';\n\n/** Message type */\nexport type MessageType =\n  | 'text'\n  | 'image'\n  | 'video'\n  | 'audio'\n  | 'file'\n  | 'link'\n  | 'embed'\n  | 'reaction'\n  | 'system';\n\n/** Payment status */\nexport type PaymentStatus =\n  | 'pending'\n  | 'processing'\n  | 'completed'\n  | 'failed'\n  | 'refunded';\n\n/** Currency type */\nexport type Currency =\n  | 'BSV'\n  | 'BTC'\n  | 'ETH'\n  | 'SOL'\n  | 'USDT'\n  | 'USDC'\n  | 'USD'\n  | 'GBP'\n  | 'EUR';\n\n/** Participant role */\nexport type ParticipantRole =\n  | 'creator'\n  | 'recipient'\n  | 'moderator'\n  | 'subscriber'\n  | 'viewer';\n\n/** Chat participant */\nexport interface ChatParticipant {\n  id: string;\n  walletAddress?: string;\n  displayName: string;\n  avatar?: string;\n  role: ParticipantRole;\n  joinedAt: Date;\n  isVerified: boolean;\n}\n\n/** Rate structure */\nexport interface RateStructure {\n  model: PaymentModel;\n  amount: bigint;\n  currency: Currency;\n  minimumPayment?: bigint;\n  maximumPayment?: bigint;\n  freeAllowance?: number;\n}\n\n/** Chat contract */\nexport interface ChatContract {\n  id: string;\n  creatorId: string;\n  title: string;\n  description?: string;\n  rates: RateStructure[];\n  status: ContractStatus;\n  createdAt: Date;\n  updatedAt: Date;\n  expiresAt?: Date;\n  participants: ChatParticipant[];\n  totalEarnings: bigint;\n  totalMessages: number;\n  metadata?: Record<string, unknown>;\n}\n\n/** Message payment */\nexport interface MessagePayment {\n  id: string;\n  messageId: string;\n  contractId: string;\n  senderId: string;\n  recipientId: string;\n  amount: bigint;\n  currency: Currency;\n  status: PaymentStatus;\n  txid?: string;\n  createdAt: Date;\n  completedAt?: Date;\n  error?: string;\n}\n\n/** Chat message */\nexport interface ChatMessage {\n  id: string;\n  contractId: string;\n  senderId: string;\n  type: MessageType;\n  content: string;\n  attachments?: MessageAttachment[];\n  payment?: MessagePayment;\n  isPaid: boolean;\n  isLocked: boolean;\n  createdAt: Date;\n  editedAt?: Date;\n  reactions?: MessageReaction[];\n}\n\n/** Message attachment */\nexport interface MessageAttachment {\n  id: string;\n  type: 'image' | 'video' | 'audio' | 'file';\n  url: string;\n  filename: string;\n  size: number;\n  mimeType: string;\n  thumbnail?: string;\n  unlockPrice?: bigint;\n}\n\n/** Message reaction */\nexport interface MessageReaction {\n  emoji: string;\n  userId: string;\n  tipAmount?: bigint;\n  createdAt: Date;\n}\n\n/** Subscription tier */\nexport interface SubscriptionTier {\n  id: string;\n  name: string;\n  price: bigint;\n  currency: Currency;\n  interval: 'daily' | 'weekly' | 'monthly' | 'yearly';\n  benefits: string[];\n  maxMessages?: number;\n  prioritySupport: boolean;\n}\n\n/** User subscription */\nexport interface UserSubscription {\n  id: string;\n  userId: string;\n  contractId: string;\n  tierId: string;\n  status: 'active' | 'cancelled' | 'expired';\n  startedAt: Date;\n  expiresAt: Date;\n  renewsAt?: Date;\n  paymentHistory: MessagePayment[];\n}\n\n/** Earnings summary */\nexport interface EarningsSummary {\n  contractId: string;\n  period: 'day' | 'week' | 'month' | 'all';\n  totalMessages: number;\n  paidMessages: number;\n  totalEarnings: bigint;\n  currency: Currency;\n  topPayingUsers: Array<{ userId: string; amount: bigint }>;\n  messageBreakdown: Record<MessageType, number>;\n}\n\n/** Contract settings */\nexport interface ContractSettings {\n  allowTips: boolean;\n  tipMinimum?: bigint;\n  tipMaximum?: bigint;\n  allowReactions: boolean;\n  paidReactions: boolean;\n  reactionPrice?: bigint;\n  allowAttachments: boolean;\n  attachmentSizeLimit: number;\n  contentModeration: boolean;\n  autoUnlock: boolean;\n  unlockDelay?: number;\n}\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\nexport const DEFAULT_CONTRACT_SETTINGS: ContractSettings = {\n  allowTips: true,\n  tipMinimum: 100n, // 100 satoshis\n  allowReactions: true,\n  paidReactions: false,\n  allowAttachments: true,\n  attachmentSizeLimit: 10 * 1024 * 1024, // 10MB\n  contentModeration: true,\n  autoUnlock: false,\n};\n\nexport const DEFAULT_RATE: RateStructure = {\n  model: 'per-message',\n  amount: 1000n, // 1000 satoshis\n  currency: 'BSV',\n  minimumPayment: 100n,\n};\n\n// ============================================================================\n// Chat Contract Manager\n// ============================================================================\n\nexport class ChatContractManager {\n  private contracts: Map<string, ChatContract> = new Map();\n  private messages: Map<string, ChatMessage[]> = new Map();\n  private payments: Map<string, MessagePayment[]> = new Map();\n  private subscriptions: Map<string, UserSubscription[]> = new Map();\n  private listeners: Set<(event: ContractEvent) => void> = new Set();\n\n  // ==========================================================================\n  // Contract Management\n  // ==========================================================================\n\n  createContract(\n    creatorId: string,\n    title: string,\n    rates: RateStructure[] = [DEFAULT_RATE],\n    settings?: Partial<ContractSettings>\n  ): ChatContract {\n    const id = generateContractId();\n    const now = new Date();\n\n    const contract: ChatContract = {\n      id,\n      creatorId,\n      title,\n      rates,\n      status: 'draft',\n      createdAt: now,\n      updatedAt: now,\n      participants: [\n        {\n          id: creatorId,\n          displayName: 'Creator',\n          role: 'creator',\n          joinedAt: now,\n          isVerified: false,\n        },\n      ],\n      totalEarnings: 0n,\n      totalMessages: 0,\n      metadata: { settings: { ...DEFAULT_CONTRACT_SETTINGS, ...settings } },\n    };\n\n    this.contracts.set(id, contract);\n    this.messages.set(id, []);\n    this.payments.set(id, []);\n    this.emit({ type: 'contract_created', contract });\n\n    return contract;\n  }\n\n  getContract(contractId: string): ChatContract | undefined {\n    return this.contracts.get(contractId);\n  }\n\n  updateContract(contractId: string, updates: Partial<ChatContract>): ChatContract | null {\n    const contract = this.contracts.get(contractId);\n    if (!contract) return null;\n\n    const updated: ChatContract = {\n      ...contract,\n      ...updates,\n      id: contract.id,\n      creatorId: contract.creatorId,\n      createdAt: contract.createdAt,\n      updatedAt: new Date(),\n    };\n\n    this.contracts.set(contractId, updated);\n    this.emit({ type: 'contract_updated', contract: updated });\n\n    return updated;\n  }\n\n  activateContract(contractId: string): boolean {\n    const contract = this.contracts.get(contractId);\n    if (!contract || contract.status !== 'draft') return false;\n\n    contract.status = 'active';\n    contract.updatedAt = new Date();\n    this.emit({ type: 'contract_activated', contract });\n\n    return true;\n  }\n\n  pauseContract(contractId: string): boolean {\n    const contract = this.contracts.get(contractId);\n    if (!contract || contract.status !== 'active') return false;\n\n    contract.status = 'paused';\n    contract.updatedAt = new Date();\n    this.emit({ type: 'contract_paused', contract });\n\n    return true;\n  }\n\n  // ==========================================================================\n  // Participant Management\n  // ==========================================================================\n\n  addParticipant(contractId: string, participant: Omit<ChatParticipant, 'joinedAt'>): boolean {\n    const contract = this.contracts.get(contractId);\n    if (!contract) return false;\n\n    const exists = contract.participants.some(p => p.id === participant.id);\n    if (exists) return false;\n\n    contract.participants.push({\n      ...participant,\n      joinedAt: new Date(),\n    });\n    contract.updatedAt = new Date();\n\n    this.emit({ type: 'participant_joined', contractId, participantId: participant.id });\n    return true;\n  }\n\n  removeParticipant(contractId: string, participantId: string): boolean {\n    const contract = this.contracts.get(contractId);\n    if (!contract) return false;\n\n    const index = contract.participants.findIndex(p => p.id === participantId);\n    if (index < 0) return false;\n\n    contract.participants.splice(index, 1);\n    contract.updatedAt = new Date();\n\n    this.emit({ type: 'participant_left', contractId, participantId });\n    return true;\n  }\n\n  // ==========================================================================\n  // Message Management\n  // ==========================================================================\n\n  async sendMessage(\n    contractId: string,\n    senderId: string,\n    content: string,\n    type: MessageType = 'text',\n    attachments?: MessageAttachment[]\n  ): Promise<ChatMessage | null> {\n    const contract = this.contracts.get(contractId);\n    if (!contract || contract.status !== 'active') return null;\n\n    const participant = contract.participants.find(p => p.id === senderId);\n    if (!participant) return null;\n\n    const messageId = generateMessageId();\n    const now = new Date();\n\n    // Calculate payment required\n    const payment = await this.calculatePayment(contract, content, type, attachments);\n    const isPaid = payment === null || participant.role === 'creator';\n\n    const message: ChatMessage = {\n      id: messageId,\n      contractId,\n      senderId,\n      type,\n      content,\n      attachments,\n      isPaid,\n      isLocked: !isPaid,\n      createdAt: now,\n    };\n\n    // Store message\n    const messages = this.messages.get(contractId) || [];\n    messages.push(message);\n    this.messages.set(contractId, messages);\n\n    // Update contract stats\n    contract.totalMessages++;\n    contract.updatedAt = now;\n\n    this.emit({ type: 'message_sent', contractId, message });\n    return message;\n  }\n\n  private async calculatePayment(\n    contract: ChatContract,\n    content: string,\n    type: MessageType,\n    attachments?: MessageAttachment[]\n  ): Promise<MessagePayment | null> {\n    const rate = contract.rates[0];\n    if (!rate) return null;\n\n    let amount: bigint;\n\n    switch (rate.model) {\n      case 'per-message':\n        amount = rate.amount;\n        break;\n      case 'per-word':\n        amount = rate.amount * BigInt(content.split(/\\s+/).length);\n        break;\n      case 'per-character':\n        amount = rate.amount * BigInt(content.length);\n        break;\n      default:\n        amount = rate.amount;\n    }\n\n    // Apply minimum\n    if (rate.minimumPayment && amount < rate.minimumPayment) {\n      amount = rate.minimumPayment;\n    }\n\n    // Apply maximum\n    if (rate.maximumPayment && amount > rate.maximumPayment) {\n      amount = rate.maximumPayment;\n    }\n\n    return {\n      id: generatePaymentId(),\n      messageId: '',\n      contractId: contract.id,\n      senderId: '',\n      recipientId: contract.creatorId,\n      amount,\n      currency: rate.currency,\n      status: 'pending',\n      createdAt: new Date(),\n    };\n  }\n\n  getMessages(contractId: string, limit?: number, before?: Date): ChatMessage[] {\n    let messages = this.messages.get(contractId) || [];\n\n    if (before) {\n      messages = messages.filter(m => m.createdAt < before);\n    }\n\n    if (limit) {\n      messages = messages.slice(-limit);\n    }\n\n    return messages;\n  }\n\n  unlockMessage(contractId: string, messageId: string, payment: MessagePayment): boolean {\n    const messages = this.messages.get(contractId);\n    if (!messages) return false;\n\n    const message = messages.find(m => m.id === messageId);\n    if (!message || message.isPaid) return false;\n\n    message.isPaid = true;\n    message.isLocked = false;\n    message.payment = payment;\n\n    // Update earnings\n    const contract = this.contracts.get(contractId);\n    if (contract) {\n      contract.totalEarnings += payment.amount;\n      contract.updatedAt = new Date();\n    }\n\n    // Store payment\n    const payments = this.payments.get(contractId) || [];\n    payments.push(payment);\n    this.payments.set(contractId, payments);\n\n    this.emit({ type: 'message_unlocked', contractId, messageId, payment });\n    return true;\n  }\n\n  // ==========================================================================\n  // Tips and Reactions\n  // ==========================================================================\n\n  sendTip(\n    contractId: string,\n    senderId: string,\n    recipientId: string,\n    amount: bigint,\n    currency: Currency = 'BSV',\n    messageId?: string\n  ): MessagePayment {\n    const payment: MessagePayment = {\n      id: generatePaymentId(),\n      messageId: messageId || '',\n      contractId,\n      senderId,\n      recipientId,\n      amount,\n      currency,\n      status: 'pending',\n      createdAt: new Date(),\n    };\n\n    const payments = this.payments.get(contractId) || [];\n    payments.push(payment);\n    this.payments.set(contractId, payments);\n\n    this.emit({ type: 'tip_sent', contractId, payment });\n    return payment;\n  }\n\n  addReaction(\n    contractId: string,\n    messageId: string,\n    userId: string,\n    emoji: string,\n    tipAmount?: bigint\n  ): boolean {\n    const messages = this.messages.get(contractId);\n    if (!messages) return false;\n\n    const message = messages.find(m => m.id === messageId);\n    if (!message) return false;\n\n    if (!message.reactions) {\n      message.reactions = [];\n    }\n\n    message.reactions.push({\n      emoji,\n      userId,\n      tipAmount,\n      createdAt: new Date(),\n    });\n\n    this.emit({ type: 'reaction_added', contractId, messageId, emoji, userId });\n    return true;\n  }\n\n  // ==========================================================================\n  // Subscriptions\n  // ==========================================================================\n\n  createSubscription(\n    userId: string,\n    contractId: string,\n    tier: SubscriptionTier\n  ): UserSubscription {\n    const now = new Date();\n    const expiresAt = new Date(now);\n\n    switch (tier.interval) {\n      case 'daily':\n        expiresAt.setDate(expiresAt.getDate() + 1);\n        break;\n      case 'weekly':\n        expiresAt.setDate(expiresAt.getDate() + 7);\n        break;\n      case 'monthly':\n        expiresAt.setMonth(expiresAt.getMonth() + 1);\n        break;\n      case 'yearly':\n        expiresAt.setFullYear(expiresAt.getFullYear() + 1);\n        break;\n    }\n\n    const subscription: UserSubscription = {\n      id: generateSubscriptionId(),\n      userId,\n      contractId,\n      tierId: tier.id,\n      status: 'active',\n      startedAt: now,\n      expiresAt,\n      renewsAt: expiresAt,\n      paymentHistory: [],\n    };\n\n    const subs = this.subscriptions.get(userId) || [];\n    subs.push(subscription);\n    this.subscriptions.set(userId, subs);\n\n    this.emit({ type: 'subscription_created', subscription });\n    return subscription;\n  }\n\n  getUserSubscriptions(userId: string): UserSubscription[] {\n    return this.subscriptions.get(userId) || [];\n  }\n\n  hasActiveSubscription(userId: string, contractId: string): boolean {\n    const subs = this.subscriptions.get(userId) || [];\n    return subs.some(\n      s =>\n        s.contractId === contractId &&\n        s.status === 'active' &&\n        s.expiresAt > new Date()\n    );\n  }\n\n  // ==========================================================================\n  // Analytics\n  // ==========================================================================\n\n  getEarningsSummary(\n    contractId: string,\n    period: 'day' | 'week' | 'month' | 'all' = 'all'\n  ): EarningsSummary {\n    const contract = this.contracts.get(contractId);\n    const payments = this.payments.get(contractId) || [];\n    const messages = this.messages.get(contractId) || [];\n\n    const now = new Date();\n    let startDate: Date;\n\n    switch (period) {\n      case 'day':\n        startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n        break;\n      case 'week':\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        break;\n      case 'month':\n        startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n        break;\n      default:\n        startDate = new Date(0);\n    }\n\n    const periodPayments = payments.filter(p => p.createdAt >= startDate);\n    const periodMessages = messages.filter(m => m.createdAt >= startDate);\n\n    const userTotals = new Map<string, bigint>();\n    for (const payment of periodPayments) {\n      const current = userTotals.get(payment.senderId) || 0n;\n      userTotals.set(payment.senderId, current + payment.amount);\n    }\n\n    const messageBreakdown: Record<MessageType, number> = {\n      text: 0,\n      image: 0,\n      video: 0,\n      audio: 0,\n      file: 0,\n      link: 0,\n      embed: 0,\n      reaction: 0,\n      system: 0,\n    };\n\n    for (const message of periodMessages) {\n      messageBreakdown[message.type]++;\n    }\n\n    return {\n      contractId,\n      period,\n      totalMessages: periodMessages.length,\n      paidMessages: periodMessages.filter(m => m.isPaid).length,\n      totalEarnings: periodPayments.reduce((sum, p) => sum + p.amount, 0n),\n      currency: contract?.rates[0]?.currency || 'BSV',\n      topPayingUsers: Array.from(userTotals.entries())\n        .map(([userId, amount]) => ({ userId, amount }))\n        .sort((a, b) => (b.amount > a.amount ? 1 : -1))\n        .slice(0, 10),\n      messageBreakdown,\n    };\n  }\n\n  // ==========================================================================\n  // Events\n  // ==========================================================================\n\n  on(callback: (event: ContractEvent) => void): () => void {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  private emit(event: ContractEvent): void {\n    for (const listener of this.listeners) {\n      listener(event);\n    }\n  }\n}\n\n/** Contract event */\nexport type ContractEvent =\n  | { type: 'contract_created'; contract: ChatContract }\n  | { type: 'contract_updated'; contract: ChatContract }\n  | { type: 'contract_activated'; contract: ChatContract }\n  | { type: 'contract_paused'; contract: ChatContract }\n  | { type: 'participant_joined'; contractId: string; participantId: string }\n  | { type: 'participant_left'; contractId: string; participantId: string }\n  | { type: 'message_sent'; contractId: string; message: ChatMessage }\n  | { type: 'message_unlocked'; contractId: string; messageId: string; payment: MessagePayment }\n  | { type: 'tip_sent'; contractId: string; payment: MessagePayment }\n  | { type: 'reaction_added'; contractId: string; messageId: string; emoji: string; userId: string }\n  | { type: 'subscription_created'; subscription: UserSubscription };\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\nexport function createChatContractManager(): ChatContractManager {\n  return new ChatContractManager();\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nfunction generateContractId(): string {\n  return `contract_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;\n}\n\nfunction generateMessageId(): string {\n  return `msg_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;\n}\n\nfunction generatePaymentId(): string {\n  return `pay_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;\n}\n\nfunction generateSubscriptionId(): string {\n  return `sub_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;\n}\n\nexport function formatPaymentAmount(amount: bigint, currency: Currency): string {\n  const num = Number(amount);\n\n  switch (currency) {\n    case 'BSV':\n    case 'BTC':\n      if (num < 100000) return `${num} sats`;\n      return `${(num / 100000000).toFixed(8)} ${currency}`;\n    case 'ETH':\n      return `${(num / 1e18).toFixed(6)} ETH`;\n    case 'SOL':\n      return `${(num / 1e9).toFixed(4)} SOL`;\n    case 'USD':\n    case 'GBP':\n    case 'EUR':\n      return `${(num / 100).toFixed(2)} ${currency}`;\n    default:\n      return `${num} ${currency}`;\n  }\n}\n\nexport function calculateWordCount(text: string): number {\n  return text.trim().split(/\\s+/).filter(w => w.length > 0).length;\n}\n\nexport function calculateCharacterCount(text: string): number {\n  return text.length;\n}\n\nexport function estimateMessageCost(\n  content: string,\n  rate: RateStructure\n): bigint {\n  let amount: bigint;\n\n  switch (rate.model) {\n    case 'per-message':\n      amount = rate.amount;\n      break;\n    case 'per-word':\n      amount = rate.amount * BigInt(calculateWordCount(content));\n      break;\n    case 'per-character':\n      amount = rate.amount * BigInt(calculateCharacterCount(content));\n      break;\n    default:\n      amount = rate.amount;\n  }\n\n  if (rate.minimumPayment && amount < rate.minimumPayment) {\n    return rate.minimumPayment;\n  }\n\n  if (rate.maximumPayment && amount > rate.maximumPayment) {\n    return rate.maximumPayment;\n  }\n\n  return amount;\n}\n\nexport function isSubscriptionActive(subscription: UserSubscription): boolean {\n  return subscription.status === 'active' && subscription.expiresAt > new Date();\n}\n\nexport function getNextRenewalDate(subscription: UserSubscription): Date | null {\n  if (subscription.status !== 'active') return null;\n  return subscription.renewsAt || null;\n}\n"],"mappings":"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","names":[]}