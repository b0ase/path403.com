{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/shareholder-ui\n *\n * Cap table and shareholder display types and utilities.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Shareholder type */\nexport type ShareholderType =\n  | 'founder'\n  | 'investor'\n  | 'employee'\n  | 'advisor'\n  | 'treasury'\n  | 'reserved'\n  | 'public';\n\n/** Share class */\nexport type ShareClass = 'common' | 'preferred' | 'seed' | 'series-a' | 'series-b' | 'options';\n\n/** Vesting status */\nexport type VestingStatus = 'not-started' | 'vesting' | 'fully-vested' | 'cancelled';\n\n/** Shareholder */\nexport interface Shareholder {\n  id: string;\n  name: string;\n  type: ShareholderType;\n  address?: string;\n  email?: string;\n  avatarUrl?: string;\n  shares: bigint;\n  shareClass: ShareClass;\n  percentOwnership: number;\n  vestingSchedule?: VestingSchedule;\n  acquisitionDate: Date;\n  pricePerShare?: number;\n  totalInvested?: number;\n  metadata?: Record<string, unknown>;\n}\n\n/** Vesting schedule */\nexport interface VestingSchedule {\n  totalShares: bigint;\n  vestedShares: bigint;\n  unvestedShares: bigint;\n  cliffDate: Date;\n  vestingEndDate: Date;\n  vestingPeriodMonths: number;\n  cliffMonths: number;\n  status: VestingStatus;\n  nextVestingDate?: Date;\n  vestingEvents: VestingEvent[];\n}\n\n/** Vesting event */\nexport interface VestingEvent {\n  date: Date;\n  sharesVested: bigint;\n  percentVested: number;\n  isClaimed: boolean;\n}\n\n/** Cap table */\nexport interface CapTable {\n  companyName: string;\n  totalShares: bigint;\n  issuedShares: bigint;\n  reservedShares: bigint;\n  shareholders: Shareholder[];\n  shareClasses: ShareClassInfo[];\n  valuation?: number;\n  pricePerShare?: number;\n  lastUpdated: Date;\n}\n\n/** Share class info */\nexport interface ShareClassInfo {\n  class: ShareClass;\n  totalShares: bigint;\n  issuedShares: bigint;\n  pricePerShare?: number;\n  votingRights: number;\n  liquidationPreference?: number;\n  participatingPreferred?: boolean;\n}\n\n/** Ownership summary */\nexport interface OwnershipSummary {\n  byType: Record<ShareholderType, { count: number; shares: bigint; percent: number }>;\n  byClass: Record<ShareClass, { count: number; shares: bigint; percent: number }>;\n  topHolders: Shareholder[];\n  totalHolders: number;\n}\n\n/** Distribution round */\nexport interface DistributionRound {\n  id: string;\n  name: string;\n  totalAmount: number;\n  currency: string;\n  perShareAmount: number;\n  eligibleShares: bigint;\n  distributedAt: Date;\n  payments: DistributionPayment[];\n}\n\n/** Distribution payment */\nexport interface DistributionPayment {\n  shareholderId: string;\n  shareholderName: string;\n  shares: bigint;\n  amount: number;\n  status: 'pending' | 'paid' | 'failed';\n  txid?: string;\n}\n\n// ============================================================================\n// Cap Table Manager\n// ============================================================================\n\nexport class CapTableManager {\n  private capTable: CapTable;\n\n  constructor(companyName: string, totalShares: bigint) {\n    this.capTable = {\n      companyName,\n      totalShares,\n      issuedShares: BigInt(0),\n      reservedShares: BigInt(0),\n      shareholders: [],\n      shareClasses: [],\n      lastUpdated: new Date(),\n    };\n  }\n\n  private generateId(): string {\n    return `sh-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  addShareholder(input: Omit<Shareholder, 'id' | 'percentOwnership'>): Shareholder {\n    const shareholder: Shareholder = {\n      ...input,\n      id: this.generateId(),\n      percentOwnership: 0,\n    };\n\n    this.capTable.shareholders.push(shareholder);\n    this.capTable.issuedShares += input.shares;\n    this.recalculateOwnership();\n    this.capTable.lastUpdated = new Date();\n\n    return shareholder;\n  }\n\n  removeShareholder(id: string): boolean {\n    const index = this.capTable.shareholders.findIndex(s => s.id === id);\n    if (index === -1) return false;\n\n    const shareholder = this.capTable.shareholders[index];\n    this.capTable.issuedShares -= shareholder.shares;\n    this.capTable.shareholders.splice(index, 1);\n    this.recalculateOwnership();\n    this.capTable.lastUpdated = new Date();\n\n    return true;\n  }\n\n  updateShares(id: string, newShares: bigint): Shareholder | undefined {\n    const shareholder = this.capTable.shareholders.find(s => s.id === id);\n    if (!shareholder) return undefined;\n\n    const diff = newShares - shareholder.shares;\n    shareholder.shares = newShares;\n    this.capTable.issuedShares += diff;\n    this.recalculateOwnership();\n    this.capTable.lastUpdated = new Date();\n\n    return shareholder;\n  }\n\n  private recalculateOwnership(): void {\n    const total = Number(this.capTable.issuedShares);\n    for (const shareholder of this.capTable.shareholders) {\n      shareholder.percentOwnership = total > 0\n        ? (Number(shareholder.shares) / total) * 100\n        : 0;\n    }\n  }\n\n  getCapTable(): CapTable {\n    return { ...this.capTable };\n  }\n\n  getShareholder(id: string): Shareholder | undefined {\n    return this.capTable.shareholders.find(s => s.id === id);\n  }\n\n  getOwnershipSummary(): OwnershipSummary {\n    const byType: Record<string, { count: number; shares: bigint; percent: number }> = {};\n    const byClass: Record<string, { count: number; shares: bigint; percent: number }> = {};\n\n    for (const sh of this.capTable.shareholders) {\n      // By type\n      if (!byType[sh.type]) {\n        byType[sh.type] = { count: 0, shares: BigInt(0), percent: 0 };\n      }\n      byType[sh.type].count++;\n      byType[sh.type].shares += sh.shares;\n      byType[sh.type].percent += sh.percentOwnership;\n\n      // By class\n      if (!byClass[sh.shareClass]) {\n        byClass[sh.shareClass] = { count: 0, shares: BigInt(0), percent: 0 };\n      }\n      byClass[sh.shareClass].count++;\n      byClass[sh.shareClass].shares += sh.shares;\n      byClass[sh.shareClass].percent += sh.percentOwnership;\n    }\n\n    const topHolders = [...this.capTable.shareholders]\n      .sort((a, b) => Number(b.shares - a.shares))\n      .slice(0, 10);\n\n    return {\n      byType: byType as OwnershipSummary['byType'],\n      byClass: byClass as OwnershipSummary['byClass'],\n      topHolders,\n      totalHolders: this.capTable.shareholders.length,\n    };\n  }\n\n  calculateDistribution(totalAmount: number, currency: string = 'USD'): DistributionPayment[] {\n    const payments: DistributionPayment[] = [];\n    const eligibleShares = this.capTable.issuedShares;\n\n    if (eligibleShares === BigInt(0)) return payments;\n\n    const perShareAmount = totalAmount / Number(eligibleShares);\n\n    for (const sh of this.capTable.shareholders) {\n      payments.push({\n        shareholderId: sh.id,\n        shareholderName: sh.name,\n        shares: sh.shares,\n        amount: Number(sh.shares) * perShareAmount,\n        status: 'pending',\n      });\n    }\n\n    return payments;\n  }\n\n  setValuation(valuation: number): void {\n    this.capTable.valuation = valuation;\n    this.capTable.pricePerShare = valuation / Number(this.capTable.totalShares);\n    this.capTable.lastUpdated = new Date();\n  }\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nexport function createCapTableManager(companyName: string, totalShares: bigint): CapTableManager {\n  return new CapTableManager(companyName, totalShares);\n}\n\nexport function formatShares(shares: bigint): string {\n  const num = Number(shares);\n  if (num >= 1e9) return `${(num / 1e9).toFixed(2)}B`;\n  if (num >= 1e6) return `${(num / 1e6).toFixed(2)}M`;\n  if (num >= 1e3) return `${(num / 1e3).toFixed(2)}K`;\n  return num.toLocaleString();\n}\n\nexport function formatPercent(percent: number, decimals: number = 2): string {\n  return `${percent.toFixed(decimals)}%`;\n}\n\nexport function calculateDilution(currentShares: bigint, newShares: bigint): number {\n  const total = currentShares + newShares;\n  return (Number(newShares) / Number(total)) * 100;\n}\n\nexport function getVestingProgress(schedule: VestingSchedule): number {\n  return Number(schedule.vestedShares) / Number(schedule.totalShares) * 100;\n}\n\nexport function getNextVestingAmount(schedule: VestingSchedule): bigint {\n  const monthlyVest = schedule.totalShares / BigInt(schedule.vestingPeriodMonths - schedule.cliffMonths);\n  return monthlyVest;\n}\n"],"mappings":"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","names":[]}