{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/logger\n *\n * Structured logging with levels, namespaces, and transports.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Log levels */\nexport type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'fatal';\n\n/** Log level numeric values */\nexport const LOG_LEVELS: Record<LogLevel, number> = {\n  trace: 10,\n  debug: 20,\n  info: 30,\n  warn: 40,\n  error: 50,\n  fatal: 60,\n};\n\n/** Log entry */\nexport interface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  namespace: string;\n  message: string;\n  data?: Record<string, unknown>;\n  error?: Error;\n}\n\n/** Transport function */\nexport type Transport = (entry: LogEntry) => void | Promise<void>;\n\n/** Logger options */\nexport interface LoggerOptions {\n  namespace?: string;\n  level?: LogLevel;\n  transports?: Transport[];\n  context?: Record<string, unknown>;\n  enabled?: boolean;\n}\n\n/** Formatter function */\nexport type Formatter = (entry: LogEntry) => string;\n\n// ============================================================================\n// Default Formatters\n// ============================================================================\n\nexport const formatters = {\n  simple: (entry: LogEntry): string => {\n    const time = entry.timestamp.split('T')[1]?.split('.')[0] || entry.timestamp;\n    const ns = entry.namespace ? `[${entry.namespace}]` : '';\n    const data = entry.data ? ` ${JSON.stringify(entry.data)}` : '';\n    const error = entry.error ? ` Error: ${entry.error.message}` : '';\n    return `${time} ${entry.level.toUpperCase().padEnd(5)} ${ns} ${entry.message}${data}${error}`;\n  },\n\n  json: (entry: LogEntry): string => {\n    return JSON.stringify({\n      ...entry,\n      error: entry.error ? { message: entry.error.message, stack: entry.error.stack } : undefined,\n    });\n  },\n\n  pretty: (entry: LogEntry): string => {\n    const colors: Record<LogLevel, string> = {\n      trace: '\\x1b[90m',\n      debug: '\\x1b[36m',\n      info: '\\x1b[32m',\n      warn: '\\x1b[33m',\n      error: '\\x1b[31m',\n      fatal: '\\x1b[35m',\n    };\n    const reset = '\\x1b[0m';\n    const color = colors[entry.level];\n    const time = entry.timestamp.split('T')[1]?.split('.')[0] || entry.timestamp;\n    const ns = entry.namespace ? `${color}[${entry.namespace}]${reset}` : '';\n    const data = entry.data ? `\\n  ${JSON.stringify(entry.data, null, 2)}` : '';\n    const error = entry.error ? `\\n  ${entry.error.stack || entry.error.message}` : '';\n    return `${time} ${color}${entry.level.toUpperCase().padEnd(5)}${reset} ${ns} ${entry.message}${data}${error}`;\n  },\n};\n\n// ============================================================================\n// Default Transports\n// ============================================================================\n\nexport const transports = {\n  console: (formatter: Formatter = formatters.simple): Transport => {\n    return (entry: LogEntry) => {\n      const output = formatter(entry);\n      if (entry.level === 'error' || entry.level === 'fatal') {\n        console.error(output);\n      } else if (entry.level === 'warn') {\n        console.warn(output);\n      } else if (entry.level === 'debug' || entry.level === 'trace') {\n        console.debug(output);\n      } else {\n        console.log(output);\n      }\n    };\n  },\n\n  memory: (buffer: LogEntry[], maxSize: number = 1000): Transport => {\n    return (entry: LogEntry) => {\n      buffer.push(entry);\n      if (buffer.length > maxSize) {\n        buffer.shift();\n      }\n    };\n  },\n\n  callback: (fn: (entry: LogEntry) => void): Transport => fn,\n};\n\n// ============================================================================\n// Logger Class\n// ============================================================================\n\nexport class Logger {\n  private namespace: string;\n  private level: LogLevel;\n  private transports: Transport[];\n  private context: Record<string, unknown>;\n  private enabled: boolean;\n\n  constructor(options: LoggerOptions = {}) {\n    this.namespace = options.namespace || '';\n    this.level = options.level || 'info';\n    this.transports = options.transports || [transports.console(formatters.simple)];\n    this.context = options.context || {};\n    this.enabled = options.enabled !== false;\n  }\n\n  // ==========================================================================\n  // Configuration\n  // ==========================================================================\n\n  setLevel(level: LogLevel): this {\n    this.level = level;\n    return this;\n  }\n\n  getLevel(): LogLevel {\n    return this.level;\n  }\n\n  enable(): this {\n    this.enabled = true;\n    return this;\n  }\n\n  disable(): this {\n    this.enabled = false;\n    return this;\n  }\n\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  addTransport(transport: Transport): this {\n    this.transports.push(transport);\n    return this;\n  }\n\n  clearTransports(): this {\n    this.transports = [];\n    return this;\n  }\n\n  setContext(context: Record<string, unknown>): this {\n    this.context = context;\n    return this;\n  }\n\n  addContext(context: Record<string, unknown>): this {\n    this.context = { ...this.context, ...context };\n    return this;\n  }\n\n  // ==========================================================================\n  // Child Loggers\n  // ==========================================================================\n\n  child(namespace: string, options?: Partial<LoggerOptions>): Logger {\n    const childNamespace = this.namespace ? `${this.namespace}:${namespace}` : namespace;\n    return new Logger({\n      namespace: childNamespace,\n      level: options?.level || this.level,\n      transports: options?.transports || this.transports,\n      context: { ...this.context, ...options?.context },\n      enabled: options?.enabled ?? this.enabled,\n    });\n  }\n\n  // ==========================================================================\n  // Logging Methods\n  // ==========================================================================\n\n  private shouldLog(level: LogLevel): boolean {\n    return this.enabled && LOG_LEVELS[level] >= LOG_LEVELS[this.level];\n  }\n\n  private log(level: LogLevel, message: string, data?: Record<string, unknown>, error?: Error): void {\n    if (!this.shouldLog(level)) return;\n\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      namespace: this.namespace,\n      message,\n      data: data ? { ...this.context, ...data } : Object.keys(this.context).length > 0 ? this.context : undefined,\n      error,\n    };\n\n    for (const transport of this.transports) {\n      try {\n        transport(entry);\n      } catch {\n        // Silently ignore transport errors\n      }\n    }\n  }\n\n  trace(message: string, data?: Record<string, unknown>): void {\n    this.log('trace', message, data);\n  }\n\n  debug(message: string, data?: Record<string, unknown>): void {\n    this.log('debug', message, data);\n  }\n\n  info(message: string, data?: Record<string, unknown>): void {\n    this.log('info', message, data);\n  }\n\n  warn(message: string, data?: Record<string, unknown>): void {\n    this.log('warn', message, data);\n  }\n\n  error(message: string, error?: Error | Record<string, unknown>, data?: Record<string, unknown>): void {\n    if (error instanceof Error) {\n      this.log('error', message, data, error);\n    } else {\n      this.log('error', message, error);\n    }\n  }\n\n  fatal(message: string, error?: Error | Record<string, unknown>, data?: Record<string, unknown>): void {\n    if (error instanceof Error) {\n      this.log('fatal', message, data, error);\n    } else {\n      this.log('fatal', message, error);\n    }\n  }\n\n  // ==========================================================================\n  // Utility Methods\n  // ==========================================================================\n\n  time(label: string): () => void {\n    const start = Date.now();\n    return () => {\n      const duration = Date.now() - start;\n      this.debug(`${label} completed`, { duration, durationMs: duration });\n    };\n  }\n\n  async timed<T>(label: string, fn: () => Promise<T>): Promise<T> {\n    const end = this.time(label);\n    try {\n      const result = await fn();\n      end();\n      return result;\n    } catch (err) {\n      this.error(`${label} failed`, err instanceof Error ? err : undefined);\n      throw err;\n    }\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\nexport function createLogger(options?: LoggerOptions): Logger {\n  return new Logger(options);\n}\n\n// ============================================================================\n// Global Logger Registry\n// ============================================================================\n\nconst loggerRegistry = new Map<string, Logger>();\n\nexport function getLogger(namespace: string, options?: LoggerOptions): Logger {\n  let logger = loggerRegistry.get(namespace);\n  if (!logger) {\n    logger = createLogger({ ...options, namespace });\n    loggerRegistry.set(namespace, logger);\n  }\n  return logger;\n}\n\nexport function setGlobalLevel(level: LogLevel): void {\n  for (const logger of loggerRegistry.values()) {\n    logger.setLevel(level);\n  }\n}\n\nexport function enableAll(): void {\n  for (const logger of loggerRegistry.values()) {\n    logger.enable();\n  }\n}\n\nexport function disableAll(): void {\n  for (const logger of loggerRegistry.values()) {\n    logger.disable();\n  }\n}\n\nexport function clearLoggers(): void {\n  loggerRegistry.clear();\n}\n\n// ============================================================================\n// Default Export\n// ============================================================================\n\nexport const log = createLogger({ namespace: 'app' });\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBO,IAAM,aAAuC;AAAA,EAClD,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AACT;AA+BO,IAAM,aAAa;AAAA,EACxB,QAAQ,CAAC,UAA4B;AACnC,UAAM,OAAO,MAAM,UAAU,MAAM,GAAG,EAAE,CAAC,GAAG,MAAM,GAAG,EAAE,CAAC,KAAK,MAAM;AACnE,UAAM,KAAK,MAAM,YAAY,IAAI,MAAM,SAAS,MAAM;AACtD,UAAM,OAAO,MAAM,OAAO,IAAI,KAAK,UAAU,MAAM,IAAI,CAAC,KAAK;AAC7D,UAAM,QAAQ,MAAM,QAAQ,WAAW,MAAM,MAAM,OAAO,KAAK;AAC/D,WAAO,GAAG,IAAI,IAAI,MAAM,MAAM,YAAY,EAAE,OAAO,CAAC,CAAC,IAAI,EAAE,IAAI,MAAM,OAAO,GAAG,IAAI,GAAG,KAAK;AAAA,EAC7F;AAAA,EAEA,MAAM,CAAC,UAA4B;AACjC,WAAO,KAAK,UAAU;AAAA,MACpB,GAAG;AAAA,MACH,OAAO,MAAM,QAAQ,EAAE,SAAS,MAAM,MAAM,SAAS,OAAO,MAAM,MAAM,MAAM,IAAI;AAAA,IACpF,CAAC;AAAA,EACH;AAAA,EAEA,QAAQ,CAAC,UAA4B;AACnC,UAAM,SAAmC;AAAA,MACvC,OAAO;AAAA,MACP,OAAO;AAAA,MACP,MAAM;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,OAAO;AAAA,IACT;AACA,UAAM,QAAQ;AACd,UAAM,QAAQ,OAAO,MAAM,KAAK;AAChC,UAAM,OAAO,MAAM,UAAU,MAAM,GAAG,EAAE,CAAC,GAAG,MAAM,GAAG,EAAE,CAAC,KAAK,MAAM;AACnE,UAAM,KAAK,MAAM,YAAY,GAAG,KAAK,IAAI,MAAM,SAAS,IAAI,KAAK,KAAK;AACtE,UAAM,OAAO,MAAM,OAAO;AAAA,IAAO,KAAK,UAAU,MAAM,MAAM,MAAM,CAAC,CAAC,KAAK;AACzE,UAAM,QAAQ,MAAM,QAAQ;AAAA,IAAO,MAAM,MAAM,SAAS,MAAM,MAAM,OAAO,KAAK;AAChF,WAAO,GAAG,IAAI,IAAI,KAAK,GAAG,MAAM,MAAM,YAAY,EAAE,OAAO,CAAC,CAAC,GAAG,KAAK,IAAI,EAAE,IAAI,MAAM,OAAO,GAAG,IAAI,GAAG,KAAK;AAAA,EAC7G;AACF;AAMO,IAAM,aAAa;AAAA,EACxB,SAAS,CAAC,YAAuB,WAAW,WAAsB;AAChE,WAAO,CAAC,UAAoB;AAC1B,YAAM,SAAS,UAAU,KAAK;AAC9B,UAAI,MAAM,UAAU,WAAW,MAAM,UAAU,SAAS;AACtD,gBAAQ,MAAM,MAAM;AAAA,MACtB,WAAW,MAAM,UAAU,QAAQ;AACjC,gBAAQ,KAAK,MAAM;AAAA,MACrB,WAAW,MAAM,UAAU,WAAW,MAAM,UAAU,SAAS;AAC7D,gBAAQ,MAAM,MAAM;AAAA,MACtB,OAAO;AACL,gBAAQ,IAAI,MAAM;AAAA,MACpB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,QAAQ,CAAC,QAAoB,UAAkB,QAAoB;AACjE,WAAO,CAAC,UAAoB;AAC1B,aAAO,KAAK,KAAK;AACjB,UAAI,OAAO,SAAS,SAAS;AAC3B,eAAO,MAAM;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EAEA,UAAU,CAAC,OAA6C;AAC1D;AAMO,IAAM,SAAN,MAAM,QAAO;AAAA,EAOlB,YAAY,UAAyB,CAAC,GAAG;AACvC,SAAK,YAAY,QAAQ,aAAa;AACtC,SAAK,QAAQ,QAAQ,SAAS;AAC9B,SAAK,aAAa,QAAQ,cAAc,CAAC,WAAW,QAAQ,WAAW,MAAM,CAAC;AAC9E,SAAK,UAAU,QAAQ,WAAW,CAAC;AACnC,SAAK,UAAU,QAAQ,YAAY;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAMA,SAAS,OAAuB;AAC9B,SAAK,QAAQ;AACb,WAAO;AAAA,EACT;AAAA,EAEA,WAAqB;AACnB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,SAAe;AACb,SAAK,UAAU;AACf,WAAO;AAAA,EACT;AAAA,EAEA,UAAgB;AACd,SAAK,UAAU;AACf,WAAO;AAAA,EACT;AAAA,EAEA,YAAqB;AACnB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,aAAa,WAA4B;AACvC,SAAK,WAAW,KAAK,SAAS;AAC9B,WAAO;AAAA,EACT;AAAA,EAEA,kBAAwB;AACtB,SAAK,aAAa,CAAC;AACnB,WAAO;AAAA,EACT;AAAA,EAEA,WAAW,SAAwC;AACjD,SAAK,UAAU;AACf,WAAO;AAAA,EACT;AAAA,EAEA,WAAW,SAAwC;AACjD,SAAK,UAAU,EAAE,GAAG,KAAK,SAAS,GAAG,QAAQ;AAC7C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,WAAmB,SAA0C;AACjE,UAAM,iBAAiB,KAAK,YAAY,GAAG,KAAK,SAAS,IAAI,SAAS,KAAK;AAC3E,WAAO,IAAI,QAAO;AAAA,MAChB,WAAW;AAAA,MACX,OAAO,SAAS,SAAS,KAAK;AAAA,MAC9B,YAAY,SAAS,cAAc,KAAK;AAAA,MACxC,SAAS,EAAE,GAAG,KAAK,SAAS,GAAG,SAAS,QAAQ;AAAA,MAChD,SAAS,SAAS,WAAW,KAAK;AAAA,IACpC,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAMQ,UAAU,OAA0B;AAC1C,WAAO,KAAK,WAAW,WAAW,KAAK,KAAK,WAAW,KAAK,KAAK;AAAA,EACnE;AAAA,EAEQ,IAAI,OAAiB,SAAiB,MAAgC,OAAqB;AACjG,QAAI,CAAC,KAAK,UAAU,KAAK,EAAG;AAE5B,UAAM,QAAkB;AAAA,MACtB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC;AAAA,MACA,WAAW,KAAK;AAAA,MAChB;AAAA,MACA,MAAM,OAAO,EAAE,GAAG,KAAK,SAAS,GAAG,KAAK,IAAI,OAAO,KAAK,KAAK,OAAO,EAAE,SAAS,IAAI,KAAK,UAAU;AAAA,MAClG;AAAA,IACF;AAEA,eAAW,aAAa,KAAK,YAAY;AACvC,UAAI;AACF,kBAAU,KAAK;AAAA,MACjB,QAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,SAAiB,MAAsC;AAC3D,SAAK,IAAI,SAAS,SAAS,IAAI;AAAA,EACjC;AAAA,EAEA,MAAM,SAAiB,MAAsC;AAC3D,SAAK,IAAI,SAAS,SAAS,IAAI;AAAA,EACjC;AAAA,EAEA,KAAK,SAAiB,MAAsC;AAC1D,SAAK,IAAI,QAAQ,SAAS,IAAI;AAAA,EAChC;AAAA,EAEA,KAAK,SAAiB,MAAsC;AAC1D,SAAK,IAAI,QAAQ,SAAS,IAAI;AAAA,EAChC;AAAA,EAEA,MAAM,SAAiB,OAAyC,MAAsC;AACpG,QAAI,iBAAiB,OAAO;AAC1B,WAAK,IAAI,SAAS,SAAS,MAAM,KAAK;AAAA,IACxC,OAAO;AACL,WAAK,IAAI,SAAS,SAAS,KAAK;AAAA,IAClC;AAAA,EACF;AAAA,EAEA,MAAM,SAAiB,OAAyC,MAAsC;AACpG,QAAI,iBAAiB,OAAO;AAC1B,WAAK,IAAI,SAAS,SAAS,MAAM,KAAK;AAAA,IACxC,OAAO;AACL,WAAK,IAAI,SAAS,SAAS,KAAK;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,KAAK,OAA2B;AAC9B,UAAM,QAAQ,KAAK,IAAI;AACvB,WAAO,MAAM;AACX,YAAM,WAAW,KAAK,IAAI,IAAI;AAC9B,WAAK,MAAM,GAAG,KAAK,cAAc,EAAE,UAAU,YAAY,SAAS,CAAC;AAAA,IACrE;AAAA,EACF;AAAA,EAEA,MAAM,MAAS,OAAe,IAAkC;AAC9D,UAAM,MAAM,KAAK,KAAK,KAAK;AAC3B,QAAI;AACF,YAAM,SAAS,MAAM,GAAG;AACxB,UAAI;AACJ,aAAO;AAAA,IACT,SAAS,KAAK;AACZ,WAAK,MAAM,GAAG,KAAK,WAAW,eAAe,QAAQ,MAAM,MAAS;AACpE,YAAM;AAAA,IACR;AAAA,EACF;AACF;AAMO,SAAS,aAAa,SAAiC;AAC5D,SAAO,IAAI,OAAO,OAAO;AAC3B;AAMA,IAAM,iBAAiB,oBAAI,IAAoB;AAExC,SAAS,UAAU,WAAmB,SAAiC;AAC5E,MAAI,SAAS,eAAe,IAAI,SAAS;AACzC,MAAI,CAAC,QAAQ;AACX,aAAS,aAAa,EAAE,GAAG,SAAS,UAAU,CAAC;AAC/C,mBAAe,IAAI,WAAW,MAAM;AAAA,EACtC;AACA,SAAO;AACT;AAEO,SAAS,eAAe,OAAuB;AACpD,aAAW,UAAU,eAAe,OAAO,GAAG;AAC5C,WAAO,SAAS,KAAK;AAAA,EACvB;AACF;AAEO,SAAS,YAAkB;AAChC,aAAW,UAAU,eAAe,OAAO,GAAG;AAC5C,WAAO,OAAO;AAAA,EAChB;AACF;AAEO,SAAS,aAAmB;AACjC,aAAW,UAAU,eAAe,OAAO,GAAG;AAC5C,WAAO,QAAQ;AAAA,EACjB;AACF;AAEO,SAAS,eAAqB;AACnC,iBAAe,MAAM;AACvB;AAMO,IAAM,MAAM,aAAa,EAAE,WAAW,MAAM,CAAC;","names":[]}