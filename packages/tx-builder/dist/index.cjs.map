{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/tx-builder\n *\n * Transaction building utilities for multi-chain transactions.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** UTXO type */\nexport interface UTXO {\n  txid: string;\n  vout: number;\n  satoshis: bigint;\n  script: string;\n  scriptType?: ScriptType;\n  confirmations?: number;\n  height?: number;\n}\n\n/** Script type */\nexport type ScriptType =\n  | 'p2pkh'\n  | 'p2pk'\n  | 'p2sh'\n  | 'p2wpkh'\n  | 'p2wsh'\n  | 'p2tr'\n  | 'multisig'\n  | 'op-return'\n  | 'custom';\n\n/** Transaction input */\nexport interface TxInput {\n  txid: string;\n  vout: number;\n  satoshis: bigint;\n  script?: string;\n  unlockingScript?: string;\n  sequence?: number;\n}\n\n/** Transaction output */\nexport interface TxOutput {\n  satoshis: bigint;\n  script: string;\n  address?: string;\n  data?: Uint8Array;\n}\n\n/** Transaction */\nexport interface Transaction {\n  version: number;\n  inputs: TxInput[];\n  outputs: TxOutput[];\n  locktime: number;\n  hash?: string;\n  size?: number;\n  fee?: bigint;\n}\n\n/** Fee rate */\nexport interface FeeRate {\n  satoshisPerByte: number;\n  priority: 'low' | 'medium' | 'high';\n}\n\n/** Coin selection strategy */\nexport type CoinSelectionStrategy =\n  | 'largest-first'\n  | 'smallest-first'\n  | 'oldest-first'\n  | 'random'\n  | 'branch-and-bound';\n\n/** Coin selection result */\nexport interface CoinSelectionResult {\n  inputs: UTXO[];\n  totalInput: bigint;\n  totalOutput: bigint;\n  fee: bigint;\n  change: bigint;\n  waste: bigint;\n}\n\n/** Build options */\nexport interface BuildOptions {\n  feeRate?: FeeRate;\n  changeAddress?: string;\n  minChange?: bigint;\n  dustThreshold?: bigint;\n  coinSelection?: CoinSelectionStrategy;\n  locktime?: number;\n  version?: number;\n  rbf?: boolean;\n}\n\n/** Script template */\nexport interface ScriptTemplate {\n  type: ScriptType;\n  data: Record<string, unknown>;\n}\n\n/** Multisig config */\nexport interface MultisigConfig {\n  threshold: number;\n  publicKeys: string[];\n  sortedKeys?: boolean;\n}\n\n/** OP_RETURN data */\nexport interface OpReturnData {\n  protocol?: string;\n  data: Uint8Array | string;\n  encoding?: 'utf8' | 'hex' | 'base64';\n}\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\nexport const DEFAULT_FEE_RATE: FeeRate = {\n  satoshisPerByte: 1,\n  priority: 'medium',\n};\n\nexport const DEFAULT_BUILD_OPTIONS: BuildOptions = {\n  feeRate: DEFAULT_FEE_RATE,\n  minChange: 546n,\n  dustThreshold: 546n,\n  coinSelection: 'largest-first',\n  locktime: 0,\n  version: 2,\n  rbf: false,\n};\n\nexport const SIGHASH_ALL = 0x01;\nexport const SIGHASH_NONE = 0x02;\nexport const SIGHASH_SINGLE = 0x03;\nexport const SIGHASH_ANYONECANPAY = 0x80;\nexport const SIGHASH_FORKID = 0x40;\n\n// ============================================================================\n// Transaction Builder\n// ============================================================================\n\nexport class TransactionBuilder {\n  private inputs: TxInput[] = [];\n  private outputs: TxOutput[] = [];\n  private utxos: UTXO[] = [];\n  private options: BuildOptions;\n\n  constructor(options?: Partial<BuildOptions>) {\n    this.options = { ...DEFAULT_BUILD_OPTIONS, ...options };\n  }\n\n  // ==========================================================================\n  // Input Management\n  // ==========================================================================\n\n  addInput(input: TxInput): this {\n    this.inputs.push({\n      sequence: this.options.rbf ? 0xfffffffd : 0xffffffff,\n      ...input,\n    });\n    return this;\n  }\n\n  addUTXO(utxo: UTXO): this {\n    this.utxos.push(utxo);\n    return this;\n  }\n\n  addUTXOs(utxos: UTXO[]): this {\n    this.utxos.push(...utxos);\n    return this;\n  }\n\n  clearInputs(): this {\n    this.inputs = [];\n    return this;\n  }\n\n  // ==========================================================================\n  // Output Management\n  // ==========================================================================\n\n  addOutput(output: TxOutput): this {\n    this.outputs.push(output);\n    return this;\n  }\n\n  addP2PKHOutput(address: string, satoshis: bigint): this {\n    const script = createP2PKHScript(address);\n    this.outputs.push({ satoshis, script, address });\n    return this;\n  }\n\n  addOpReturnOutput(data: OpReturnData): this {\n    const script = createOpReturnScript(data);\n    this.outputs.push({ satoshis: 0n, script });\n    return this;\n  }\n\n  addDataOutput(data: Uint8Array | string): this {\n    const bytes = typeof data === 'string' ? new TextEncoder().encode(data) : data;\n    const script = createOpReturnScript({ data: bytes });\n    this.outputs.push({ satoshis: 0n, script, data: bytes });\n    return this;\n  }\n\n  clearOutputs(): this {\n    this.outputs = [];\n    return this;\n  }\n\n  // ==========================================================================\n  // Building\n  // ==========================================================================\n\n  selectCoins(targetAmount: bigint): CoinSelectionResult {\n    const strategy = this.options.coinSelection || 'largest-first';\n    const sortedUTXOs = this.sortUTXOs(this.utxos, strategy);\n\n    const selected: UTXO[] = [];\n    let totalInput = 0n;\n\n    // Estimate fee\n    const estimatedSize = this.estimateSize(this.inputs.length + 1, this.outputs.length + 1);\n    const estimatedFee = BigInt(Math.ceil(estimatedSize * (this.options.feeRate?.satoshisPerByte || 1)));\n\n    const requiredAmount = targetAmount + estimatedFee;\n\n    for (const utxo of sortedUTXOs) {\n      if (totalInput >= requiredAmount) break;\n      selected.push(utxo);\n      totalInput += utxo.satoshis;\n    }\n\n    if (totalInput < requiredAmount) {\n      throw new Error(`Insufficient funds: need ${requiredAmount}, have ${totalInput}`);\n    }\n\n    const totalOutput = targetAmount;\n    const fee = estimatedFee;\n    const change = totalInput - totalOutput - fee;\n    const waste = change < (this.options.minChange || 546n) ? change : 0n;\n\n    return {\n      inputs: selected,\n      totalInput,\n      totalOutput,\n      fee,\n      change: change >= (this.options.minChange || 546n) ? change : 0n,\n      waste,\n    };\n  }\n\n  private sortUTXOs(utxos: UTXO[], strategy: CoinSelectionStrategy): UTXO[] {\n    const sorted = [...utxos];\n\n    switch (strategy) {\n      case 'largest-first':\n        return sorted.sort((a, b) => (b.satoshis > a.satoshis ? 1 : -1));\n      case 'smallest-first':\n        return sorted.sort((a, b) => (a.satoshis > b.satoshis ? 1 : -1));\n      case 'oldest-first':\n        return sorted.sort((a, b) => (b.confirmations || 0) - (a.confirmations || 0));\n      case 'random':\n        return sorted.sort(() => Math.random() - 0.5);\n      default:\n        return sorted;\n    }\n  }\n\n  build(): Transaction {\n    // Calculate total output\n    const totalOutput = this.outputs.reduce((sum, o) => sum + o.satoshis, 0n);\n\n    // Select coins if we have UTXOs\n    if (this.utxos.length > 0 && this.inputs.length === 0) {\n      const selection = this.selectCoins(totalOutput);\n\n      // Add selected UTXOs as inputs\n      for (const utxo of selection.inputs) {\n        this.addInput({\n          txid: utxo.txid,\n          vout: utxo.vout,\n          satoshis: utxo.satoshis,\n          script: utxo.script,\n        });\n      }\n\n      // Add change output if needed\n      if (selection.change > 0n && this.options.changeAddress) {\n        this.addP2PKHOutput(this.options.changeAddress, selection.change);\n      }\n    }\n\n    const tx: Transaction = {\n      version: this.options.version || 2,\n      inputs: [...this.inputs],\n      outputs: [...this.outputs],\n      locktime: this.options.locktime || 0,\n    };\n\n    // Calculate size and fee\n    tx.size = this.calculateSize(tx);\n    tx.fee = this.calculateFee(tx);\n\n    return tx;\n  }\n\n  // ==========================================================================\n  // Estimation\n  // ==========================================================================\n\n  estimateSize(inputCount?: number, outputCount?: number): number {\n    const numInputs = inputCount ?? this.inputs.length;\n    const numOutputs = outputCount ?? this.outputs.length;\n\n    // Base transaction overhead\n    let size = 10; // version (4) + locktime (4) + varint overhead (~2)\n\n    // Inputs: ~148 bytes each for P2PKH\n    size += numInputs * 148;\n\n    // Outputs: ~34 bytes each for P2PKH\n    size += numOutputs * 34;\n\n    return size;\n  }\n\n  private calculateSize(tx: Transaction): number {\n    let size = 10;\n    size += tx.inputs.length * 148;\n    size += tx.outputs.reduce((sum, o) => {\n      return sum + 8 + 1 + (o.script.length / 2);\n    }, 0);\n    return size;\n  }\n\n  estimateFee(): bigint {\n    const size = this.estimateSize();\n    return BigInt(Math.ceil(size * (this.options.feeRate?.satoshisPerByte || 1)));\n  }\n\n  private calculateFee(tx: Transaction): bigint {\n    const size = tx.size || this.calculateSize(tx);\n    return BigInt(Math.ceil(size * (this.options.feeRate?.satoshisPerByte || 1)));\n  }\n\n  // ==========================================================================\n  // Serialization\n  // ==========================================================================\n\n  toHex(): string {\n    const tx = this.build();\n    return serializeTransaction(tx);\n  }\n\n  toJSON(): object {\n    return this.build();\n  }\n\n  // ==========================================================================\n  // Reset\n  // ==========================================================================\n\n  reset(): this {\n    this.inputs = [];\n    this.outputs = [];\n    this.utxos = [];\n    return this;\n  }\n\n  // ==========================================================================\n  // Static Helpers\n  // ==========================================================================\n\n  static fromHex(hex: string): TransactionBuilder {\n    const tx = parseTransaction(hex);\n    const builder = new TransactionBuilder();\n    builder.inputs = tx.inputs;\n    builder.outputs = tx.outputs;\n    return builder;\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\nexport function createTransactionBuilder(options?: Partial<BuildOptions>): TransactionBuilder {\n  return new TransactionBuilder(options);\n}\n\n// ============================================================================\n// Script Utilities\n// ============================================================================\n\nexport function createP2PKHScript(address: string): string {\n  // Decode address to get pubkey hash\n  const decoded = decodeAddress(address);\n  if (!decoded) throw new Error('Invalid address');\n\n  // OP_DUP OP_HASH160 <20 bytes> OP_EQUALVERIFY OP_CHECKSIG\n  return `76a914${decoded.hash}88ac`;\n}\n\nexport function createP2SHScript(scriptHash: string): string {\n  // OP_HASH160 <20 bytes> OP_EQUAL\n  return `a914${scriptHash}87`;\n}\n\nexport function createOpReturnScript(data: OpReturnData): string {\n  let bytes: Uint8Array;\n\n  if (typeof data.data === 'string') {\n    switch (data.encoding) {\n      case 'hex':\n        bytes = hexToBytes(data.data);\n        break;\n      case 'base64':\n        bytes = base64ToBytes(data.data);\n        break;\n      default:\n        bytes = new TextEncoder().encode(data.data);\n    }\n  } else {\n    bytes = data.data;\n  }\n\n  const pushData = createPushData(bytes);\n  const protocolPush = data.protocol\n    ? createPushData(new TextEncoder().encode(data.protocol))\n    : '';\n\n  // OP_FALSE OP_RETURN [protocol] <data>\n  return `006a${protocolPush}${pushData}`;\n}\n\nexport function createMultisigScript(config: MultisigConfig): string {\n  const { threshold, publicKeys, sortedKeys } = config;\n\n  if (threshold > publicKeys.length) {\n    throw new Error('Threshold cannot exceed number of public keys');\n  }\n\n  const keys = sortedKeys ? [...publicKeys].sort() : publicKeys;\n  const m = threshold + 0x50; // OP_1 = 0x51, OP_2 = 0x52, etc.\n  const n = keys.length + 0x50;\n\n  let script = m.toString(16).padStart(2, '0');\n\n  for (const key of keys) {\n    script += createPushData(hexToBytes(key));\n  }\n\n  script += n.toString(16).padStart(2, '0');\n  script += 'ae'; // OP_CHECKMULTISIG\n\n  return script;\n}\n\nfunction createPushData(data: Uint8Array): string {\n  const len = data.length;\n  let prefix: string;\n\n  if (len <= 75) {\n    prefix = len.toString(16).padStart(2, '0');\n  } else if (len <= 255) {\n    prefix = '4c' + len.toString(16).padStart(2, '0');\n  } else if (len <= 65535) {\n    prefix = '4d' + len.toString(16).padStart(4, '0');\n  } else {\n    prefix = '4e' + len.toString(16).padStart(8, '0');\n  }\n\n  return prefix + bytesToHex(data);\n}\n\n// ============================================================================\n// Address Utilities\n// ============================================================================\n\nexport interface DecodedAddress {\n  version: number;\n  hash: string;\n  type: 'p2pkh' | 'p2sh';\n}\n\nexport function decodeAddress(address: string): DecodedAddress | null {\n  try {\n    const decoded = base58Decode(address);\n    if (!decoded || decoded.length !== 25) return null;\n\n    const version = decoded[0];\n    const hash = bytesToHex(decoded.slice(1, 21));\n    const checksum = decoded.slice(21);\n\n    // Verify checksum\n    const payload = decoded.slice(0, 21);\n    const expectedChecksum = doubleSha256(payload).slice(0, 4);\n\n    for (let i = 0; i < 4; i++) {\n      if (checksum[i] !== expectedChecksum[i]) return null;\n    }\n\n    // Determine type based on version byte\n    const type = version === 0x00 || version === 0x6f ? 'p2pkh' : 'p2sh';\n\n    return { version, hash, type };\n  } catch {\n    return null;\n  }\n}\n\nexport function encodeAddress(hash: string, type: 'p2pkh' | 'p2sh', testnet: boolean = false): string {\n  const version = type === 'p2pkh'\n    ? (testnet ? 0x6f : 0x00)\n    : (testnet ? 0xc4 : 0x05);\n\n  const payload = new Uint8Array(21);\n  payload[0] = version;\n  payload.set(hexToBytes(hash), 1);\n\n  const checksum = doubleSha256(payload).slice(0, 4);\n  const full = new Uint8Array(25);\n  full.set(payload);\n  full.set(checksum, 21);\n\n  return base58Encode(full);\n}\n\n// ============================================================================\n// Serialization\n// ============================================================================\n\nexport function serializeTransaction(tx: Transaction): string {\n  let hex = '';\n\n  // Version (4 bytes, little endian)\n  hex += int32ToHex(tx.version);\n\n  // Input count\n  hex += varIntToHex(tx.inputs.length);\n\n  // Inputs\n  for (const input of tx.inputs) {\n    hex += reverseHex(input.txid);\n    hex += int32ToHex(input.vout);\n    const script = input.unlockingScript || '';\n    hex += varIntToHex(script.length / 2);\n    hex += script;\n    hex += int32ToHex(input.sequence ?? 0xffffffff);\n  }\n\n  // Output count\n  hex += varIntToHex(tx.outputs.length);\n\n  // Outputs\n  for (const output of tx.outputs) {\n    hex += int64ToHex(output.satoshis);\n    hex += varIntToHex(output.script.length / 2);\n    hex += output.script;\n  }\n\n  // Locktime (4 bytes, little endian)\n  hex += int32ToHex(tx.locktime);\n\n  return hex;\n}\n\nexport function parseTransaction(hex: string): Transaction {\n  let offset = 0;\n\n  const readBytes = (count: number): string => {\n    const result = hex.slice(offset, offset + count * 2);\n    offset += count * 2;\n    return result;\n  };\n\n  const readInt32 = (): number => {\n    const bytes = readBytes(4);\n    return hexToInt32(bytes);\n  };\n\n  const readInt64 = (): bigint => {\n    const bytes = readBytes(8);\n    return hexToInt64(bytes);\n  };\n\n  const readVarInt = (): number => {\n    const first = parseInt(readBytes(1), 16);\n    if (first < 0xfd) return first;\n    if (first === 0xfd) return parseInt(reverseHex(readBytes(2)), 16);\n    if (first === 0xfe) return parseInt(reverseHex(readBytes(4)), 16);\n    return parseInt(reverseHex(readBytes(8)), 16);\n  };\n\n  const version = readInt32();\n\n  const inputCount = readVarInt();\n  const inputs: TxInput[] = [];\n\n  for (let i = 0; i < inputCount; i++) {\n    const txid = reverseHex(readBytes(32));\n    const vout = readInt32();\n    const scriptLen = readVarInt();\n    const unlockingScript = readBytes(scriptLen);\n    const sequence = readInt32();\n\n    inputs.push({\n      txid,\n      vout,\n      satoshis: 0n, // Not in raw tx\n      unlockingScript,\n      sequence,\n    });\n  }\n\n  const outputCount = readVarInt();\n  const outputs: TxOutput[] = [];\n\n  for (let i = 0; i < outputCount; i++) {\n    const satoshis = readInt64();\n    const scriptLen = readVarInt();\n    const script = readBytes(scriptLen);\n\n    outputs.push({ satoshis, script });\n  }\n\n  const locktime = readInt32();\n\n  return { version, inputs, outputs, locktime };\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nfunction hexToBytes(hex: string): Uint8Array {\n  const bytes = new Uint8Array(hex.length / 2);\n  for (let i = 0; i < bytes.length; i++) {\n    bytes[i] = parseInt(hex.slice(i * 2, i * 2 + 2), 16);\n  }\n  return bytes;\n}\n\nfunction bytesToHex(bytes: Uint8Array): string {\n  return Array.from(bytes)\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('');\n}\n\nfunction base64ToBytes(base64: string): Uint8Array {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes;\n}\n\nfunction reverseHex(hex: string): string {\n  const bytes = hex.match(/.{2}/g) || [];\n  return bytes.reverse().join('');\n}\n\nfunction int32ToHex(n: number): string {\n  const buf = new ArrayBuffer(4);\n  new DataView(buf).setUint32(0, n, true);\n  return bytesToHex(new Uint8Array(buf));\n}\n\nfunction int64ToHex(n: bigint): string {\n  const buf = new ArrayBuffer(8);\n  new DataView(buf).setBigUint64(0, n, true);\n  return bytesToHex(new Uint8Array(buf));\n}\n\nfunction hexToInt32(hex: string): number {\n  const bytes = hexToBytes(hex);\n  return new DataView(bytes.buffer).getUint32(0, true);\n}\n\nfunction hexToInt64(hex: string): bigint {\n  const bytes = hexToBytes(hex);\n  return new DataView(bytes.buffer).getBigUint64(0, true);\n}\n\nfunction varIntToHex(n: number): string {\n  if (n < 0xfd) {\n    return n.toString(16).padStart(2, '0');\n  } else if (n <= 0xffff) {\n    return 'fd' + reverseHex(n.toString(16).padStart(4, '0'));\n  } else if (n <= 0xffffffff) {\n    return 'fe' + reverseHex(n.toString(16).padStart(8, '0'));\n  } else {\n    return 'ff' + reverseHex(n.toString(16).padStart(16, '0'));\n  }\n}\n\nconst BASE58_ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\n\nfunction base58Decode(str: string): Uint8Array | null {\n  let num = 0n;\n  for (const char of str) {\n    const index = BASE58_ALPHABET.indexOf(char);\n    if (index === -1) return null;\n    num = num * 58n + BigInt(index);\n  }\n\n  const hex = num.toString(16).padStart(50, '0');\n  const bytes = hexToBytes(hex);\n\n  // Count leading zeros\n  let leadingZeros = 0;\n  for (const char of str) {\n    if (char !== '1') break;\n    leadingZeros++;\n  }\n\n  const result = new Uint8Array(leadingZeros + bytes.length);\n  result.set(bytes, leadingZeros);\n  return result;\n}\n\nfunction base58Encode(bytes: Uint8Array): string {\n  let num = 0n;\n  for (const byte of bytes) {\n    num = num * 256n + BigInt(byte);\n  }\n\n  let result = '';\n  while (num > 0n) {\n    const remainder = Number(num % 58n);\n    num = num / 58n;\n    result = BASE58_ALPHABET[remainder] + result;\n  }\n\n  // Handle leading zeros\n  for (const byte of bytes) {\n    if (byte !== 0) break;\n    result = '1' + result;\n  }\n\n  return result;\n}\n\nfunction doubleSha256(data: Uint8Array): Uint8Array {\n  // Placeholder - in real implementation would use crypto\n  // For now return zeros (this would need a real SHA256 implementation)\n  return new Uint8Array(32);\n}\n\nexport function calculateTxid(tx: Transaction): string {\n  const hex = serializeTransaction(tx);\n  const bytes = hexToBytes(hex);\n  const hash = doubleSha256(bytes);\n  return reverseHex(bytesToHex(hash));\n}\n\nexport function estimateVSize(inputCount: number, outputCount: number, isSegwit: boolean = false): number {\n  if (!isSegwit) {\n    return 10 + inputCount * 148 + outputCount * 34;\n  }\n  // SegWit: witness data is discounted\n  const baseSize = 10 + inputCount * 41 + outputCount * 34;\n  const witnessSize = inputCount * 107;\n  return Math.ceil((baseSize * 3 + baseSize + witnessSize) / 4);\n}\n"],"mappings":"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","names":[]}