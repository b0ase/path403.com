{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * @b0ase/blockchain-email\n *\n * On-chain email system with blockchain-backed message storage and paymail integration.\n *\n * @packageDocumentation\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Email priority levels */\nexport type EmailPriority = 'low' | 'normal' | 'high' | 'urgent';\n\n/** Email status */\nexport type EmailStatus = 'draft' | 'queued' | 'sent' | 'delivered' | 'read' | 'failed';\n\n/** Encryption method */\nexport type EncryptionMethod = 'none' | 'ecies' | 'aes-256';\n\n/** Email address (paymail or traditional) */\nexport interface EmailAddress {\n  address: string;\n  name?: string;\n  publicKey?: string;\n  isPaymail: boolean;\n}\n\n/** Email attachment */\nexport interface EmailAttachment {\n  id: string;\n  filename: string;\n  mimeType: string;\n  size: number;\n  content: string; // Base64 encoded\n  txid?: string; // On-chain reference\n}\n\n/** Email message */\nexport interface Email {\n  id: string;\n  from: EmailAddress;\n  to: EmailAddress[];\n  cc?: EmailAddress[];\n  bcc?: EmailAddress[];\n  subject: string;\n  body: string;\n  bodyHtml?: string;\n  attachments?: EmailAttachment[];\n  priority: EmailPriority;\n  status: EmailStatus;\n  encryption: EncryptionMethod;\n  createdAt: number;\n  sentAt?: number;\n  readAt?: number;\n  txid?: string;\n  replyTo?: string;\n  threadId?: string;\n  headers?: Record<string, string>;\n}\n\n/** Email thread */\nexport interface EmailThread {\n  id: string;\n  subject: string;\n  participants: EmailAddress[];\n  messages: Email[];\n  lastMessageAt: number;\n  unreadCount: number;\n}\n\n/** Mailbox folder */\nexport interface Folder {\n  id: string;\n  name: string;\n  type: 'inbox' | 'sent' | 'drafts' | 'trash' | 'spam' | 'custom';\n  unreadCount: number;\n  totalCount: number;\n}\n\n/** Email filter rule */\nexport interface FilterRule {\n  id: string;\n  name: string;\n  conditions: FilterCondition[];\n  actions: FilterAction[];\n  enabled: boolean;\n}\n\n/** Filter condition */\nexport interface FilterCondition {\n  field: 'from' | 'to' | 'subject' | 'body';\n  operator: 'contains' | 'equals' | 'startsWith' | 'endsWith' | 'matches';\n  value: string;\n}\n\n/** Filter action */\nexport interface FilterAction {\n  type: 'moveTo' | 'markRead' | 'markSpam' | 'delete' | 'forward' | 'label';\n  value?: string;\n}\n\n/** Mailbox settings */\nexport interface MailboxSettings {\n  signature?: string;\n  autoReply?: {\n    enabled: boolean;\n    message: string;\n    startDate?: number;\n    endDate?: number;\n  };\n  forwardTo?: string;\n  defaultEncryption: EncryptionMethod;\n}\n\n/** Email client options */\nexport interface EmailClientOptions {\n  paymail: string;\n  privateKey?: string;\n  publicKey?: string;\n  apiEndpoint?: string;\n  autoSync?: boolean;\n  syncInterval?: number;\n}\n\n/** Send email params */\nexport interface SendEmailParams {\n  to: string | string[];\n  cc?: string | string[];\n  bcc?: string | string[];\n  subject: string;\n  body: string;\n  bodyHtml?: string;\n  attachments?: Array<{\n    filename: string;\n    content: string;\n    mimeType: string;\n  }>;\n  priority?: EmailPriority;\n  encryption?: EncryptionMethod;\n  replyTo?: string;\n}\n\n/** Compose draft params */\nexport interface ComposeDraftParams extends Partial<SendEmailParams> {\n  id?: string;\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nexport const MAX_ATTACHMENT_SIZE = 10 * 1024 * 1024; // 10MB\nexport const MAX_RECIPIENTS = 50;\nexport const MAX_SUBJECT_LENGTH = 200;\nexport const DEFAULT_FOLDERS: Folder[] = [\n  { id: 'inbox', name: 'Inbox', type: 'inbox', unreadCount: 0, totalCount: 0 },\n  { id: 'sent', name: 'Sent', type: 'sent', unreadCount: 0, totalCount: 0 },\n  { id: 'drafts', name: 'Drafts', type: 'drafts', unreadCount: 0, totalCount: 0 },\n  { id: 'trash', name: 'Trash', type: 'trash', unreadCount: 0, totalCount: 0 },\n  { id: 'spam', name: 'Spam', type: 'spam', unreadCount: 0, totalCount: 0 },\n];\n\n// ============================================================================\n// Blockchain Email Client\n// ============================================================================\n\nexport class BlockchainEmailClient {\n  private options: Required<EmailClientOptions>;\n  private emails: Map<string, Email> = new Map();\n  private threads: Map<string, EmailThread> = new Map();\n  private folders: Map<string, Folder> = new Map();\n  private filters: Map<string, FilterRule> = new Map();\n  private settings: MailboxSettings;\n  private syncTimer?: ReturnType<typeof setInterval>;\n  private listeners: Map<string, Set<(data: unknown) => void>> = new Map();\n\n  constructor(options: EmailClientOptions) {\n    this.options = {\n      paymail: options.paymail,\n      privateKey: options.privateKey || '',\n      publicKey: options.publicKey || '',\n      apiEndpoint: options.apiEndpoint || 'https://bmail.network/api',\n      autoSync: options.autoSync ?? true,\n      syncInterval: options.syncInterval || 60000,\n    };\n\n    this.settings = {\n      defaultEncryption: 'none',\n    };\n\n    // Initialize default folders\n    for (const folder of DEFAULT_FOLDERS) {\n      this.folders.set(folder.id, { ...folder });\n    }\n\n    if (this.options.autoSync) {\n      this.startSync();\n    }\n  }\n\n  // ==========================================================================\n  // Sending Emails\n  // ==========================================================================\n\n  async send(params: SendEmailParams): Promise<Email> {\n    const to = this.normalizeRecipients(params.to);\n    const cc = params.cc ? this.normalizeRecipients(params.cc) : undefined;\n    const bcc = params.bcc ? this.normalizeRecipients(params.bcc) : undefined;\n\n    this.validateEmail(to, cc, bcc, params.subject);\n\n    const email: Email = {\n      id: this.generateId('email'),\n      from: this.parseAddress(this.options.paymail),\n      to,\n      cc,\n      bcc,\n      subject: params.subject,\n      body: params.body,\n      bodyHtml: params.bodyHtml,\n      priority: params.priority || 'normal',\n      status: 'queued',\n      encryption: params.encryption || this.settings.defaultEncryption,\n      createdAt: Date.now(),\n      replyTo: params.replyTo,\n      threadId: params.replyTo ? this.getEmailThreadId(params.replyTo) : this.generateId('thread'),\n    };\n\n    // Handle attachments\n    if (params.attachments?.length) {\n      email.attachments = params.attachments.map((att) => ({\n        id: this.generateId('att'),\n        filename: att.filename,\n        mimeType: att.mimeType,\n        size: att.content.length,\n        content: att.content,\n      }));\n    }\n\n    // Encrypt if needed\n    if (email.encryption !== 'none') {\n      await this.encryptEmail(email);\n    }\n\n    // Send to blockchain\n    const txid = await this.broadcastEmail(email);\n    email.txid = txid;\n    email.status = 'sent';\n    email.sentAt = Date.now();\n\n    this.emails.set(email.id, email);\n    this.updateThread(email);\n    this.updateFolderCount('sent', 1);\n\n    this.emit('sent', email);\n    return email;\n  }\n\n  async reply(originalId: string, params: Omit<SendEmailParams, 'to'>): Promise<Email> {\n    const original = this.emails.get(originalId);\n    if (!original) {\n      throw new Error('Original email not found');\n    }\n\n    return this.send({\n      ...params,\n      to: original.from.address,\n      replyTo: originalId,\n      subject: params.subject || `Re: ${original.subject}`,\n    });\n  }\n\n  async replyAll(originalId: string, params: Omit<SendEmailParams, 'to' | 'cc'>): Promise<Email> {\n    const original = this.emails.get(originalId);\n    if (!original) {\n      throw new Error('Original email not found');\n    }\n\n    const recipients = original.to\n      .filter((addr) => addr.address !== this.options.paymail)\n      .map((addr) => addr.address);\n\n    return this.send({\n      ...params,\n      to: original.from.address,\n      cc: recipients,\n      replyTo: originalId,\n      subject: params.subject || `Re: ${original.subject}`,\n    });\n  }\n\n  async forward(originalId: string, to: string | string[]): Promise<Email> {\n    const original = this.emails.get(originalId);\n    if (!original) {\n      throw new Error('Original email not found');\n    }\n\n    return this.send({\n      to,\n      subject: `Fwd: ${original.subject}`,\n      body: this.formatForwardBody(original),\n      bodyHtml: original.bodyHtml,\n      attachments: original.attachments?.map((att) => ({\n        filename: att.filename,\n        content: att.content,\n        mimeType: att.mimeType,\n      })),\n    });\n  }\n\n  // ==========================================================================\n  // Drafts\n  // ==========================================================================\n\n  async saveDraft(params: ComposeDraftParams): Promise<Email> {\n    const id = params.id || this.generateId('email');\n    const existing = this.emails.get(id);\n\n    const draft: Email = {\n      id,\n      from: this.parseAddress(this.options.paymail),\n      to: params.to ? this.normalizeRecipients(params.to) : [],\n      cc: params.cc ? this.normalizeRecipients(params.cc) : undefined,\n      bcc: params.bcc ? this.normalizeRecipients(params.bcc) : undefined,\n      subject: params.subject || '',\n      body: params.body || '',\n      bodyHtml: params.bodyHtml,\n      priority: params.priority || 'normal',\n      status: 'draft',\n      encryption: params.encryption || this.settings.defaultEncryption,\n      createdAt: existing?.createdAt || Date.now(),\n      replyTo: params.replyTo,\n    };\n\n    this.emails.set(id, draft);\n\n    if (!existing) {\n      this.updateFolderCount('drafts', 1);\n    }\n\n    return draft;\n  }\n\n  async sendDraft(draftId: string): Promise<Email> {\n    const draft = this.emails.get(draftId);\n    if (!draft || draft.status !== 'draft') {\n      throw new Error('Draft not found');\n    }\n\n    const email = await this.send({\n      to: draft.to.map((a) => a.address),\n      cc: draft.cc?.map((a) => a.address),\n      bcc: draft.bcc?.map((a) => a.address),\n      subject: draft.subject,\n      body: draft.body,\n      bodyHtml: draft.bodyHtml,\n      attachments: draft.attachments?.map((att) => ({\n        filename: att.filename,\n        content: att.content,\n        mimeType: att.mimeType,\n      })),\n      priority: draft.priority,\n      encryption: draft.encryption,\n      replyTo: draft.replyTo,\n    });\n\n    this.emails.delete(draftId);\n    this.updateFolderCount('drafts', -1);\n\n    return email;\n  }\n\n  deleteDraft(draftId: string): boolean {\n    const draft = this.emails.get(draftId);\n    if (!draft || draft.status !== 'draft') {\n      return false;\n    }\n\n    this.emails.delete(draftId);\n    this.updateFolderCount('drafts', -1);\n    return true;\n  }\n\n  // ==========================================================================\n  // Reading Emails\n  // ==========================================================================\n\n  getEmail(id: string): Email | undefined {\n    return this.emails.get(id);\n  }\n\n  async markAsRead(id: string): Promise<void> {\n    const email = this.emails.get(id);\n    if (!email) return;\n\n    if (!email.readAt) {\n      email.readAt = Date.now();\n      email.status = 'read';\n      this.updateFolderCount('inbox', 0, -1);\n      this.emit('read', email);\n    }\n  }\n\n  async markAsUnread(id: string): Promise<void> {\n    const email = this.emails.get(id);\n    if (!email) return;\n\n    if (email.readAt) {\n      email.readAt = undefined;\n      email.status = 'delivered';\n      this.updateFolderCount('inbox', 0, 1);\n    }\n  }\n\n  // ==========================================================================\n  // Folders\n  // ==========================================================================\n\n  getFolders(): Folder[] {\n    return Array.from(this.folders.values());\n  }\n\n  getFolder(id: string): Folder | undefined {\n    return this.folders.get(id);\n  }\n\n  createFolder(name: string): Folder {\n    const id = this.generateId('folder');\n    const folder: Folder = {\n      id,\n      name,\n      type: 'custom',\n      unreadCount: 0,\n      totalCount: 0,\n    };\n    this.folders.set(id, folder);\n    return folder;\n  }\n\n  deleteFolder(id: string): boolean {\n    const folder = this.folders.get(id);\n    if (!folder || folder.type !== 'custom') {\n      return false;\n    }\n    return this.folders.delete(id);\n  }\n\n  getEmailsByFolder(folderId: string): Email[] {\n    const emails = Array.from(this.emails.values());\n\n    switch (folderId) {\n      case 'inbox':\n        return emails.filter(\n          (e) => e.status !== 'draft' && e.to.some((addr) => addr.address === this.options.paymail)\n        );\n      case 'sent':\n        return emails.filter((e) => e.status === 'sent' && e.from.address === this.options.paymail);\n      case 'drafts':\n        return emails.filter((e) => e.status === 'draft');\n      default:\n        return emails;\n    }\n  }\n\n  // ==========================================================================\n  // Threads\n  // ==========================================================================\n\n  getThread(id: string): EmailThread | undefined {\n    return this.threads.get(id);\n  }\n\n  getThreads(): EmailThread[] {\n    return Array.from(this.threads.values()).sort((a, b) => b.lastMessageAt - a.lastMessageAt);\n  }\n\n  // ==========================================================================\n  // Filters\n  // ==========================================================================\n\n  createFilter(rule: Omit<FilterRule, 'id'>): FilterRule {\n    const filter: FilterRule = {\n      ...rule,\n      id: this.generateId('filter'),\n    };\n    this.filters.set(filter.id, filter);\n    return filter;\n  }\n\n  updateFilter(id: string, updates: Partial<FilterRule>): FilterRule | null {\n    const filter = this.filters.get(id);\n    if (!filter) return null;\n\n    Object.assign(filter, updates);\n    return filter;\n  }\n\n  deleteFilter(id: string): boolean {\n    return this.filters.delete(id);\n  }\n\n  getFilters(): FilterRule[] {\n    return Array.from(this.filters.values());\n  }\n\n  // ==========================================================================\n  // Settings\n  // ==========================================================================\n\n  getSettings(): MailboxSettings {\n    return { ...this.settings };\n  }\n\n  updateSettings(updates: Partial<MailboxSettings>): void {\n    Object.assign(this.settings, updates);\n  }\n\n  // ==========================================================================\n  // Sync\n  // ==========================================================================\n\n  async sync(): Promise<number> {\n    // In production, fetch new emails from blockchain/API\n    // For now, simulate sync\n    const newCount = 0;\n\n    this.emit('sync', { count: newCount });\n    return newCount;\n  }\n\n  startSync(): void {\n    if (this.syncTimer) return;\n    this.syncTimer = setInterval(() => this.sync(), this.options.syncInterval);\n  }\n\n  stopSync(): void {\n    if (this.syncTimer) {\n      clearInterval(this.syncTimer);\n      this.syncTimer = undefined;\n    }\n  }\n\n  // ==========================================================================\n  // Events\n  // ==========================================================================\n\n  on(event: string, callback: (data: unknown) => void): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(callback);\n    return () => this.off(event, callback);\n  }\n\n  off(event: string, callback: (data: unknown) => void): void {\n    this.listeners.get(event)?.delete(callback);\n  }\n\n  private emit(event: string, data: unknown): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      for (const callback of callbacks) {\n        callback(data);\n      }\n    }\n  }\n\n  // ==========================================================================\n  // Helpers\n  // ==========================================================================\n\n  private normalizeRecipients(input: string | string[]): EmailAddress[] {\n    const addresses = Array.isArray(input) ? input : [input];\n    return addresses.map((addr) => this.parseAddress(addr));\n  }\n\n  private parseAddress(input: string): EmailAddress {\n    const match = input.match(/^(.+?)\\s*<(.+)>$/);\n    if (match) {\n      return {\n        name: match[1].trim(),\n        address: match[2].trim(),\n        isPaymail: match[2].includes('@'),\n      };\n    }\n    return {\n      address: input.trim(),\n      isPaymail: input.includes('@'),\n    };\n  }\n\n  private validateEmail(\n    to: EmailAddress[],\n    cc?: EmailAddress[],\n    bcc?: EmailAddress[],\n    subject?: string\n  ): void {\n    const totalRecipients = to.length + (cc?.length || 0) + (bcc?.length || 0);\n\n    if (totalRecipients === 0) {\n      throw new Error('At least one recipient is required');\n    }\n\n    if (totalRecipients > MAX_RECIPIENTS) {\n      throw new Error(`Maximum ${MAX_RECIPIENTS} recipients allowed`);\n    }\n\n    if (subject && subject.length > MAX_SUBJECT_LENGTH) {\n      throw new Error(`Subject cannot exceed ${MAX_SUBJECT_LENGTH} characters`);\n    }\n  }\n\n  private async encryptEmail(email: Email): Promise<void> {\n    // In production, encrypt body and attachments\n    // For now, mark as encrypted\n    email.headers = {\n      ...email.headers,\n      'X-Encrypted': email.encryption,\n    };\n  }\n\n  private async broadcastEmail(email: Email): Promise<string> {\n    // In production, broadcast to blockchain\n    // For now, return mock txid\n    return `tx_${Date.now()}_${Math.random().toString(36).slice(2, 10)}`;\n  }\n\n  private updateThread(email: Email): void {\n    const threadId = email.threadId!;\n    let thread = this.threads.get(threadId);\n\n    if (!thread) {\n      thread = {\n        id: threadId,\n        subject: email.subject.replace(/^(Re:|Fwd:)\\s*/gi, ''),\n        participants: [],\n        messages: [],\n        lastMessageAt: email.createdAt,\n        unreadCount: 0,\n      };\n      this.threads.set(threadId, thread);\n    }\n\n    thread.messages.push(email);\n    thread.lastMessageAt = email.sentAt || email.createdAt;\n\n    // Update participants\n    const addresses = [email.from, ...email.to, ...(email.cc || [])];\n    for (const addr of addresses) {\n      if (!thread.participants.some((p) => p.address === addr.address)) {\n        thread.participants.push(addr);\n      }\n    }\n  }\n\n  private getEmailThreadId(emailId: string): string | undefined {\n    const email = this.emails.get(emailId);\n    return email?.threadId;\n  }\n\n  private updateFolderCount(folderId: string, totalDelta: number, unreadDelta: number = 0): void {\n    const folder = this.folders.get(folderId);\n    if (folder) {\n      folder.totalCount += totalDelta;\n      folder.unreadCount += unreadDelta;\n    }\n  }\n\n  private formatForwardBody(original: Email): string {\n    return `\n---------- Forwarded message ---------\nFrom: ${original.from.name || ''} <${original.from.address}>\nDate: ${new Date(original.sentAt || original.createdAt).toLocaleString()}\nSubject: ${original.subject}\nTo: ${original.to.map((a) => a.address).join(', ')}\n\n${original.body}\n`;\n  }\n\n  private generateId(prefix: string): string {\n    return `${prefix}_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\n  }\n\n  destroy(): void {\n    this.stopSync();\n    this.emails.clear();\n    this.threads.clear();\n    this.listeners.clear();\n  }\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\nexport function createEmailClient(options: EmailClientOptions): BlockchainEmailClient {\n  return new BlockchainEmailClient(options);\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Check if string is valid paymail address\n */\nexport function isPaymail(address: string): boolean {\n  return /^[a-z0-9._-]+@[a-z0-9.-]+$/i.test(address);\n}\n\n/**\n * Extract domain from paymail\n */\nexport function getPaymailDomain(paymail: string): string | null {\n  const match = paymail.match(/@(.+)$/);\n  return match ? match[1] : null;\n}\n\n/**\n * Format email address for display\n */\nexport function formatAddress(address: EmailAddress): string {\n  if (address.name) {\n    return `${address.name} <${address.address}>`;\n  }\n  return address.address;\n}\n\n/**\n * Parse email addresses from string\n */\nexport function parseAddresses(input: string): EmailAddress[] {\n  return input.split(/[,;]/).map((addr) => {\n    const match = addr.trim().match(/^(.+?)\\s*<(.+)>$/);\n    if (match) {\n      return {\n        name: match[1].trim(),\n        address: match[2].trim(),\n        isPaymail: match[2].includes('@'),\n      };\n    }\n    return {\n      address: addr.trim(),\n      isPaymail: addr.includes('@'),\n    };\n  });\n}\n\n/**\n * Create mailto link\n */\nexport function createMailtoLink(params: {\n  to: string;\n  subject?: string;\n  body?: string;\n  cc?: string;\n  bcc?: string;\n}): string {\n  const query = new URLSearchParams();\n  if (params.subject) query.set('subject', params.subject);\n  if (params.body) query.set('body', params.body);\n  if (params.cc) query.set('cc', params.cc);\n  if (params.bcc) query.set('bcc', params.bcc);\n\n  const queryStr = query.toString();\n  return `mailto:${params.to}${queryStr ? '?' + queryStr : ''}`;\n}\n"],"mappings":"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","names":[]}