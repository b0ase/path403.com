{"version":3,"sources":["../src/governance.ts"],"sourcesContent":["/**\n * @b0ase/governance - Governance engine\n *\n * Manages proposals, voting, and execution.\n */\n\nimport type {\n  ProposalStatus,\n  ProposalType,\n  VoteChoice,\n  Voter,\n  Vote,\n  Proposal,\n  ProposalAction,\n  VotingConfigSnapshot,\n  GovernanceConfig,\n  CreateProposalInput,\n  CastVoteInput,\n  ProposalResult,\n  VotingPowerBreakdown,\n} from './types';\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\nconst DEFAULT_CONFIG: GovernanceConfig = {\n  quorumPercent: 10,\n  approvalThreshold: 50,\n  proposalThreshold: BigInt(1000),\n  votingPeriodSeconds: 7 * 24 * 60 * 60, // 7 days\n  executionDelaySeconds: 2 * 24 * 60 * 60, // 2 days\n  allowDelegation: true,\n  allowVoteChanging: false,\n  allowedProposalTypes: ['general', 'treasury', 'parameter', 'membership'],\n};\n\n// ============================================================================\n// Governance Engine Class\n// ============================================================================\n\n/**\n * Governance Engine\n *\n * Manages token-based governance with proposals, voting, and execution.\n */\nexport class GovernanceEngine {\n  private config: GovernanceConfig;\n  private proposals: Map<string, Proposal> = new Map();\n  private votes: Map<string, Vote[]> = new Map(); // proposalId -> votes\n  private voters: Map<string, Voter> = new Map();\n  private proposalCounter: number = 0;\n\n  constructor(config: Partial<GovernanceConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Generate unique ID\n   */\n  private generateId(prefix: string): string {\n    return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  // ==========================================================================\n  // Voter Management\n  // ==========================================================================\n\n  /**\n   * Register or update voter\n   */\n  registerVoter(voter: Voter): Voter {\n    this.voters.set(voter.id, voter);\n    return voter;\n  }\n\n  /**\n   * Get voter\n   */\n  getVoter(voterId: string): Voter | undefined {\n    return this.voters.get(voterId);\n  }\n\n  /**\n   * Get voting power for a voter\n   */\n  getVotingPower(voterId: string): VotingPowerBreakdown {\n    const voter = this.voters.get(voterId);\n    if (!voter) {\n      return {\n        ownPower: BigInt(0),\n        delegatedPower: BigInt(0),\n        totalPower: BigInt(0),\n        delegatedAway: BigInt(0),\n      };\n    }\n\n    // If voter delegated away, they have no voting power\n    if (voter.delegatingTo) {\n      return {\n        ownPower: voter.votingPower,\n        delegatedPower: BigInt(0),\n        totalPower: BigInt(0),\n        delegatedAway: voter.votingPower,\n      };\n    }\n\n    return {\n      ownPower: voter.votingPower,\n      delegatedPower: voter.delegatedPower || BigInt(0),\n      totalPower: voter.votingPower + (voter.delegatedPower || BigInt(0)),\n      delegatedAway: BigInt(0),\n    };\n  }\n\n  /**\n   * Delegate voting power\n   */\n  delegate(fromVoterId: string, toVoterId: string): void {\n    if (!this.config.allowDelegation) {\n      throw new Error('Delegation is not allowed');\n    }\n\n    const fromVoter = this.voters.get(fromVoterId);\n    const toVoter = this.voters.get(toVoterId);\n\n    if (!fromVoter) throw new Error('From voter not found');\n    if (!toVoter) throw new Error('To voter not found');\n    if (fromVoterId === toVoterId) throw new Error('Cannot delegate to self');\n\n    // Remove previous delegation\n    if (fromVoter.delegatingTo) {\n      const prevDelegate = this.voters.get(fromVoter.delegatingTo);\n      if (prevDelegate) {\n        prevDelegate.delegatedPower =\n          (prevDelegate.delegatedPower || BigInt(0)) - fromVoter.votingPower;\n      }\n    }\n\n    // Add new delegation\n    fromVoter.delegatingTo = toVoterId;\n    toVoter.delegatedPower =\n      (toVoter.delegatedPower || BigInt(0)) + fromVoter.votingPower;\n  }\n\n  /**\n   * Remove delegation\n   */\n  undelegate(voterId: string): void {\n    const voter = this.voters.get(voterId);\n    if (!voter || !voter.delegatingTo) return;\n\n    const delegate = this.voters.get(voter.delegatingTo);\n    if (delegate) {\n      delegate.delegatedPower =\n        (delegate.delegatedPower || BigInt(0)) - voter.votingPower;\n    }\n\n    voter.delegatingTo = undefined;\n  }\n\n  // ==========================================================================\n  // Proposal Management\n  // ==========================================================================\n\n  /**\n   * Create a new proposal\n   */\n  createProposal(\n    proposerId: string,\n    input: CreateProposalInput\n  ): Proposal {\n    const voter = this.voters.get(proposerId);\n    if (!voter) {\n      throw new Error('Proposer not found');\n    }\n\n    // Check proposal threshold\n    const votingPower = this.getVotingPower(proposerId).totalPower;\n    if (votingPower < this.config.proposalThreshold) {\n      throw new Error(\n        `Insufficient voting power. Required: ${this.config.proposalThreshold}, Have: ${votingPower}`\n      );\n    }\n\n    // Check proposal type allowed\n    if (!this.config.allowedProposalTypes.includes(input.type)) {\n      throw new Error(`Proposal type not allowed: ${input.type}`);\n    }\n\n    const now = new Date();\n    const startTime = now;\n    const endTime = new Date(\n      now.getTime() + this.config.votingPeriodSeconds * 1000\n    );\n\n    // Calculate total voting supply\n    let totalVotingSupply = BigInt(0);\n    for (const v of this.voters.values()) {\n      totalVotingSupply += v.votingPower;\n    }\n\n    this.proposalCounter++;\n\n    const proposal: Proposal = {\n      id: this.generateId('prop'),\n      number: this.proposalCounter,\n      title: input.title,\n      description: input.description,\n      type: input.type,\n      status: 'active',\n      proposerId,\n      proposerAddress: voter.address,\n      actions: input.actions || [],\n      config: {\n        quorumPercent: this.config.quorumPercent,\n        approvalThreshold: this.config.approvalThreshold,\n        votingPeriodSeconds: this.config.votingPeriodSeconds,\n        executionDelaySeconds: this.config.executionDelaySeconds,\n        totalVotingSupply,\n      },\n      forVotes: BigInt(0),\n      againstVotes: BigInt(0),\n      abstainVotes: BigInt(0),\n      createdAt: now,\n      startTime,\n      endTime,\n      discussionUrl: input.discussionUrl,\n      metadata: input.metadata,\n    };\n\n    this.proposals.set(proposal.id, proposal);\n    this.votes.set(proposal.id, []);\n\n    return proposal;\n  }\n\n  /**\n   * Get proposal by ID\n   */\n  getProposal(proposalId: string): Proposal | undefined {\n    return this.proposals.get(proposalId);\n  }\n\n  /**\n   * List proposals\n   */\n  listProposals(filter?: {\n    status?: ProposalStatus;\n    type?: ProposalType;\n    proposerId?: string;\n  }): Proposal[] {\n    let proposals = Array.from(this.proposals.values());\n\n    if (filter?.status) {\n      proposals = proposals.filter((p) => p.status === filter.status);\n    }\n    if (filter?.type) {\n      proposals = proposals.filter((p) => p.type === filter.type);\n    }\n    if (filter?.proposerId) {\n      proposals = proposals.filter((p) => p.proposerId === filter.proposerId);\n    }\n\n    return proposals.sort((a, b) => b.number - a.number);\n  }\n\n  /**\n   * Cancel proposal (proposer only)\n   */\n  cancelProposal(proposalId: string, cancelerId: string): Proposal {\n    const proposal = this.proposals.get(proposalId);\n    if (!proposal) throw new Error('Proposal not found');\n\n    if (proposal.proposerId !== cancelerId) {\n      throw new Error('Only proposer can cancel');\n    }\n\n    if (!['draft', 'pending', 'active'].includes(proposal.status)) {\n      throw new Error(`Cannot cancel proposal in status: ${proposal.status}`);\n    }\n\n    proposal.status = 'cancelled';\n    proposal.cancelledAt = new Date();\n\n    return proposal;\n  }\n\n  // ==========================================================================\n  // Voting\n  // ==========================================================================\n\n  /**\n   * Cast a vote\n   */\n  castVote(voterId: string, input: CastVoteInput): Vote {\n    const voter = this.voters.get(voterId);\n    if (!voter) throw new Error('Voter not found');\n\n    const proposal = this.proposals.get(input.proposalId);\n    if (!proposal) throw new Error('Proposal not found');\n\n    // Check proposal is active\n    if (proposal.status !== 'active') {\n      throw new Error(`Cannot vote on proposal in status: ${proposal.status}`);\n    }\n\n    // Check voting period\n    const now = new Date();\n    if (now < proposal.startTime || now > proposal.endTime) {\n      throw new Error('Voting period not active');\n    }\n\n    // Check if already voted\n    const proposalVotes = this.votes.get(input.proposalId) || [];\n    const existingVote = proposalVotes.find((v) => v.voterId === voterId);\n\n    if (existingVote && !this.config.allowVoteChanging) {\n      throw new Error('Already voted and vote changing not allowed');\n    }\n\n    // Get voting power\n    const votingPower = this.getVotingPower(voterId).totalPower;\n    if (votingPower === BigInt(0)) {\n      throw new Error('No voting power');\n    }\n\n    // Remove previous vote if changing\n    if (existingVote) {\n      switch (existingVote.choice) {\n        case 'for':\n          proposal.forVotes -= existingVote.votingPower;\n          break;\n        case 'against':\n          proposal.againstVotes -= existingVote.votingPower;\n          break;\n        case 'abstain':\n          proposal.abstainVotes -= existingVote.votingPower;\n          break;\n      }\n      // Remove from votes array\n      const voteIndex = proposalVotes.indexOf(existingVote);\n      proposalVotes.splice(voteIndex, 1);\n    }\n\n    // Create vote\n    const vote: Vote = {\n      id: this.generateId('vote'),\n      proposalId: input.proposalId,\n      voterId,\n      voterAddress: voter.address,\n      choice: input.choice,\n      votingPower,\n      reason: input.reason,\n      votedAt: now,\n    };\n\n    // Apply vote\n    switch (input.choice) {\n      case 'for':\n        proposal.forVotes += votingPower;\n        break;\n      case 'against':\n        proposal.againstVotes += votingPower;\n        break;\n      case 'abstain':\n        proposal.abstainVotes += votingPower;\n        break;\n    }\n\n    proposalVotes.push(vote);\n    this.votes.set(input.proposalId, proposalVotes);\n\n    return vote;\n  }\n\n  /**\n   * Get votes for a proposal\n   */\n  getVotes(proposalId: string): Vote[] {\n    return this.votes.get(proposalId) || [];\n  }\n\n  /**\n   * Get vote by voter for a proposal\n   */\n  getVote(proposalId: string, voterId: string): Vote | undefined {\n    const votes = this.votes.get(proposalId) || [];\n    return votes.find((v) => v.voterId === voterId);\n  }\n\n  // ==========================================================================\n  // Proposal Resolution\n  // ==========================================================================\n\n  /**\n   * Calculate proposal result\n   */\n  calculateResult(proposalId: string): ProposalResult {\n    const proposal = this.proposals.get(proposalId);\n    if (!proposal) throw new Error('Proposal not found');\n\n    const totalVotes =\n      proposal.forVotes + proposal.againstVotes + proposal.abstainVotes;\n    const quorumRequired =\n      (proposal.config.totalVotingSupply *\n        BigInt(proposal.config.quorumPercent)) /\n      BigInt(100);\n    const quorumReached = totalVotes >= quorumRequired;\n\n    // Approval is for / (for + against), abstains don't count\n    const votesForApproval = proposal.forVotes + proposal.againstVotes;\n    const approvalPercent =\n      votesForApproval > BigInt(0)\n        ? Number((proposal.forVotes * BigInt(10000)) / votesForApproval) / 100\n        : 0;\n\n    const participationPercent =\n      proposal.config.totalVotingSupply > BigInt(0)\n        ? Number(\n            (totalVotes * BigInt(10000)) / proposal.config.totalVotingSupply\n          ) / 100\n        : 0;\n\n    const passed =\n      quorumReached && approvalPercent >= proposal.config.approvalThreshold;\n\n    return {\n      proposalId,\n      passed,\n      forVotes: proposal.forVotes,\n      againstVotes: proposal.againstVotes,\n      abstainVotes: proposal.abstainVotes,\n      totalVotes,\n      quorumReached,\n      quorumRequired,\n      approvalPercent,\n      approvalRequired: proposal.config.approvalThreshold,\n      participationPercent,\n    };\n  }\n\n  /**\n   * Finalize proposal (after voting period ends)\n   */\n  finalizeProposal(proposalId: string): Proposal {\n    const proposal = this.proposals.get(proposalId);\n    if (!proposal) throw new Error('Proposal not found');\n\n    if (proposal.status !== 'active') {\n      throw new Error(`Cannot finalize proposal in status: ${proposal.status}`);\n    }\n\n    const now = new Date();\n    if (now <= proposal.endTime) {\n      throw new Error('Voting period not ended');\n    }\n\n    const result = this.calculateResult(proposalId);\n    proposal.status = result.passed ? 'passed' : 'rejected';\n\n    return proposal;\n  }\n\n  /**\n   * Execute proposal (after timelock)\n   */\n  executeProposal(proposalId: string): Proposal {\n    const proposal = this.proposals.get(proposalId);\n    if (!proposal) throw new Error('Proposal not found');\n\n    if (proposal.status !== 'passed') {\n      throw new Error(`Cannot execute proposal in status: ${proposal.status}`);\n    }\n\n    const now = new Date();\n    const executionTime = new Date(\n      proposal.endTime.getTime() + proposal.config.executionDelaySeconds * 1000\n    );\n\n    if (now < executionTime) {\n      throw new Error('Execution delay not passed');\n    }\n\n    proposal.status = 'executed';\n    proposal.executedAt = now;\n\n    return proposal;\n  }\n\n  /**\n   * Check and update proposal statuses\n   */\n  updateProposalStatuses(): Proposal[] {\n    const updated: Proposal[] = [];\n    const now = new Date();\n\n    for (const proposal of this.proposals.values()) {\n      if (proposal.status === 'active' && now > proposal.endTime) {\n        this.finalizeProposal(proposal.id);\n        updated.push(proposal);\n      }\n    }\n\n    return updated;\n  }\n}\n\n// ============================================================================\n// Factory Function\n// ============================================================================\n\n/**\n * Create a governance engine\n */\nexport function createGovernanceEngine(\n  config?: Partial<GovernanceConfig>\n): GovernanceEngine {\n  return new GovernanceEngine(config);\n}\n"],"mappings":";AA0BA,IAAM,iBAAmC;AAAA,EACvC,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,mBAAmB,OAAO,GAAI;AAAA,EAC9B,qBAAqB,IAAI,KAAK,KAAK;AAAA;AAAA,EACnC,uBAAuB,IAAI,KAAK,KAAK;AAAA;AAAA,EACrC,iBAAiB;AAAA,EACjB,mBAAmB;AAAA,EACnB,sBAAsB,CAAC,WAAW,YAAY,aAAa,YAAY;AACzE;AAWO,IAAM,mBAAN,MAAuB;AAAA,EAO5B,YAAY,SAAoC,CAAC,GAAG;AALpD,SAAQ,YAAmC,oBAAI,IAAI;AACnD,SAAQ,QAA6B,oBAAI,IAAI;AAC7C;AAAA,SAAQ,SAA6B,oBAAI,IAAI;AAC7C,SAAQ,kBAA0B;AAGhC,SAAK,SAAS,EAAE,GAAG,gBAAgB,GAAG,OAAO;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAW,QAAwB;AACzC,WAAO,GAAG,MAAM,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,EAC3E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,cAAc,OAAqB;AACjC,SAAK,OAAO,IAAI,MAAM,IAAI,KAAK;AAC/B,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,SAAoC;AAC3C,WAAO,KAAK,OAAO,IAAI,OAAO;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,SAAuC;AACpD,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC,OAAO;AACV,aAAO;AAAA,QACL,UAAU,OAAO,CAAC;AAAA,QAClB,gBAAgB,OAAO,CAAC;AAAA,QACxB,YAAY,OAAO,CAAC;AAAA,QACpB,eAAe,OAAO,CAAC;AAAA,MACzB;AAAA,IACF;AAGA,QAAI,MAAM,cAAc;AACtB,aAAO;AAAA,QACL,UAAU,MAAM;AAAA,QAChB,gBAAgB,OAAO,CAAC;AAAA,QACxB,YAAY,OAAO,CAAC;AAAA,QACpB,eAAe,MAAM;AAAA,MACvB;AAAA,IACF;AAEA,WAAO;AAAA,MACL,UAAU,MAAM;AAAA,MAChB,gBAAgB,MAAM,kBAAkB,OAAO,CAAC;AAAA,MAChD,YAAY,MAAM,eAAe,MAAM,kBAAkB,OAAO,CAAC;AAAA,MACjE,eAAe,OAAO,CAAC;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,aAAqB,WAAyB;AACrD,QAAI,CAAC,KAAK,OAAO,iBAAiB;AAChC,YAAM,IAAI,MAAM,2BAA2B;AAAA,IAC7C;AAEA,UAAM,YAAY,KAAK,OAAO,IAAI,WAAW;AAC7C,UAAM,UAAU,KAAK,OAAO,IAAI,SAAS;AAEzC,QAAI,CAAC,UAAW,OAAM,IAAI,MAAM,sBAAsB;AACtD,QAAI,CAAC,QAAS,OAAM,IAAI,MAAM,oBAAoB;AAClD,QAAI,gBAAgB,UAAW,OAAM,IAAI,MAAM,yBAAyB;AAGxE,QAAI,UAAU,cAAc;AAC1B,YAAM,eAAe,KAAK,OAAO,IAAI,UAAU,YAAY;AAC3D,UAAI,cAAc;AAChB,qBAAa,kBACV,aAAa,kBAAkB,OAAO,CAAC,KAAK,UAAU;AAAA,MAC3D;AAAA,IACF;AAGA,cAAU,eAAe;AACzB,YAAQ,kBACL,QAAQ,kBAAkB,OAAO,CAAC,KAAK,UAAU;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAAuB;AAChC,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC,SAAS,CAAC,MAAM,aAAc;AAEnC,UAAM,WAAW,KAAK,OAAO,IAAI,MAAM,YAAY;AACnD,QAAI,UAAU;AACZ,eAAS,kBACN,SAAS,kBAAkB,OAAO,CAAC,KAAK,MAAM;AAAA,IACnD;AAEA,UAAM,eAAe;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,eACE,YACA,OACU;AACV,UAAM,QAAQ,KAAK,OAAO,IAAI,UAAU;AACxC,QAAI,CAAC,OAAO;AACV,YAAM,IAAI,MAAM,oBAAoB;AAAA,IACtC;AAGA,UAAM,cAAc,KAAK,eAAe,UAAU,EAAE;AACpD,QAAI,cAAc,KAAK,OAAO,mBAAmB;AAC/C,YAAM,IAAI;AAAA,QACR,wCAAwC,KAAK,OAAO,iBAAiB,WAAW,WAAW;AAAA,MAC7F;AAAA,IACF;AAGA,QAAI,CAAC,KAAK,OAAO,qBAAqB,SAAS,MAAM,IAAI,GAAG;AAC1D,YAAM,IAAI,MAAM,8BAA8B,MAAM,IAAI,EAAE;AAAA,IAC5D;AAEA,UAAM,MAAM,oBAAI,KAAK;AACrB,UAAM,YAAY;AAClB,UAAM,UAAU,IAAI;AAAA,MAClB,IAAI,QAAQ,IAAI,KAAK,OAAO,sBAAsB;AAAA,IACpD;AAGA,QAAI,oBAAoB,OAAO,CAAC;AAChC,eAAW,KAAK,KAAK,OAAO,OAAO,GAAG;AACpC,2BAAqB,EAAE;AAAA,IACzB;AAEA,SAAK;AAEL,UAAM,WAAqB;AAAA,MACzB,IAAI,KAAK,WAAW,MAAM;AAAA,MAC1B,QAAQ,KAAK;AAAA,MACb,OAAO,MAAM;AAAA,MACb,aAAa,MAAM;AAAA,MACnB,MAAM,MAAM;AAAA,MACZ,QAAQ;AAAA,MACR;AAAA,MACA,iBAAiB,MAAM;AAAA,MACvB,SAAS,MAAM,WAAW,CAAC;AAAA,MAC3B,QAAQ;AAAA,QACN,eAAe,KAAK,OAAO;AAAA,QAC3B,mBAAmB,KAAK,OAAO;AAAA,QAC/B,qBAAqB,KAAK,OAAO;AAAA,QACjC,uBAAuB,KAAK,OAAO;AAAA,QACnC;AAAA,MACF;AAAA,MACA,UAAU,OAAO,CAAC;AAAA,MAClB,cAAc,OAAO,CAAC;AAAA,MACtB,cAAc,OAAO,CAAC;AAAA,MACtB,WAAW;AAAA,MACX;AAAA,MACA;AAAA,MACA,eAAe,MAAM;AAAA,MACrB,UAAU,MAAM;AAAA,IAClB;AAEA,SAAK,UAAU,IAAI,SAAS,IAAI,QAAQ;AACxC,SAAK,MAAM,IAAI,SAAS,IAAI,CAAC,CAAC;AAE9B,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,YAA0C;AACpD,WAAO,KAAK,UAAU,IAAI,UAAU;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAIC;AACb,QAAI,YAAY,MAAM,KAAK,KAAK,UAAU,OAAO,CAAC;AAElD,QAAI,QAAQ,QAAQ;AAClB,kBAAY,UAAU,OAAO,CAAC,MAAM,EAAE,WAAW,OAAO,MAAM;AAAA,IAChE;AACA,QAAI,QAAQ,MAAM;AAChB,kBAAY,UAAU,OAAO,CAAC,MAAM,EAAE,SAAS,OAAO,IAAI;AAAA,IAC5D;AACA,QAAI,QAAQ,YAAY;AACtB,kBAAY,UAAU,OAAO,CAAC,MAAM,EAAE,eAAe,OAAO,UAAU;AAAA,IACxE;AAEA,WAAO,UAAU,KAAK,CAAC,GAAG,MAAM,EAAE,SAAS,EAAE,MAAM;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,YAAoB,YAA8B;AAC/D,UAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,QAAI,CAAC,SAAU,OAAM,IAAI,MAAM,oBAAoB;AAEnD,QAAI,SAAS,eAAe,YAAY;AACtC,YAAM,IAAI,MAAM,0BAA0B;AAAA,IAC5C;AAEA,QAAI,CAAC,CAAC,SAAS,WAAW,QAAQ,EAAE,SAAS,SAAS,MAAM,GAAG;AAC7D,YAAM,IAAI,MAAM,qCAAqC,SAAS,MAAM,EAAE;AAAA,IACxE;AAEA,aAAS,SAAS;AAClB,aAAS,cAAc,oBAAI,KAAK;AAEhC,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,SAAS,SAAiB,OAA4B;AACpD,UAAM,QAAQ,KAAK,OAAO,IAAI,OAAO;AACrC,QAAI,CAAC,MAAO,OAAM,IAAI,MAAM,iBAAiB;AAE7C,UAAM,WAAW,KAAK,UAAU,IAAI,MAAM,UAAU;AACpD,QAAI,CAAC,SAAU,OAAM,IAAI,MAAM,oBAAoB;AAGnD,QAAI,SAAS,WAAW,UAAU;AAChC,YAAM,IAAI,MAAM,sCAAsC,SAAS,MAAM,EAAE;AAAA,IACzE;AAGA,UAAM,MAAM,oBAAI,KAAK;AACrB,QAAI,MAAM,SAAS,aAAa,MAAM,SAAS,SAAS;AACtD,YAAM,IAAI,MAAM,0BAA0B;AAAA,IAC5C;AAGA,UAAM,gBAAgB,KAAK,MAAM,IAAI,MAAM,UAAU,KAAK,CAAC;AAC3D,UAAM,eAAe,cAAc,KAAK,CAAC,MAAM,EAAE,YAAY,OAAO;AAEpE,QAAI,gBAAgB,CAAC,KAAK,OAAO,mBAAmB;AAClD,YAAM,IAAI,MAAM,6CAA6C;AAAA,IAC/D;AAGA,UAAM,cAAc,KAAK,eAAe,OAAO,EAAE;AACjD,QAAI,gBAAgB,OAAO,CAAC,GAAG;AAC7B,YAAM,IAAI,MAAM,iBAAiB;AAAA,IACnC;AAGA,QAAI,cAAc;AAChB,cAAQ,aAAa,QAAQ;AAAA,QAC3B,KAAK;AACH,mBAAS,YAAY,aAAa;AAClC;AAAA,QACF,KAAK;AACH,mBAAS,gBAAgB,aAAa;AACtC;AAAA,QACF,KAAK;AACH,mBAAS,gBAAgB,aAAa;AACtC;AAAA,MACJ;AAEA,YAAM,YAAY,cAAc,QAAQ,YAAY;AACpD,oBAAc,OAAO,WAAW,CAAC;AAAA,IACnC;AAGA,UAAM,OAAa;AAAA,MACjB,IAAI,KAAK,WAAW,MAAM;AAAA,MAC1B,YAAY,MAAM;AAAA,MAClB;AAAA,MACA,cAAc,MAAM;AAAA,MACpB,QAAQ,MAAM;AAAA,MACd;AAAA,MACA,QAAQ,MAAM;AAAA,MACd,SAAS;AAAA,IACX;AAGA,YAAQ,MAAM,QAAQ;AAAA,MACpB,KAAK;AACH,iBAAS,YAAY;AACrB;AAAA,MACF,KAAK;AACH,iBAAS,gBAAgB;AACzB;AAAA,MACF,KAAK;AACH,iBAAS,gBAAgB;AACzB;AAAA,IACJ;AAEA,kBAAc,KAAK,IAAI;AACvB,SAAK,MAAM,IAAI,MAAM,YAAY,aAAa;AAE9C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,YAA4B;AACnC,WAAO,KAAK,MAAM,IAAI,UAAU,KAAK,CAAC;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,YAAoB,SAAmC;AAC7D,UAAM,QAAQ,KAAK,MAAM,IAAI,UAAU,KAAK,CAAC;AAC7C,WAAO,MAAM,KAAK,CAAC,MAAM,EAAE,YAAY,OAAO;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,gBAAgB,YAAoC;AAClD,UAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,QAAI,CAAC,SAAU,OAAM,IAAI,MAAM,oBAAoB;AAEnD,UAAM,aACJ,SAAS,WAAW,SAAS,eAAe,SAAS;AACvD,UAAM,iBACH,SAAS,OAAO,oBACf,OAAO,SAAS,OAAO,aAAa,IACtC,OAAO,GAAG;AACZ,UAAM,gBAAgB,cAAc;AAGpC,UAAM,mBAAmB,SAAS,WAAW,SAAS;AACtD,UAAM,kBACJ,mBAAmB,OAAO,CAAC,IACvB,OAAQ,SAAS,WAAW,OAAO,GAAK,IAAK,gBAAgB,IAAI,MACjE;AAEN,UAAM,uBACJ,SAAS,OAAO,oBAAoB,OAAO,CAAC,IACxC;AAAA,MACG,aAAa,OAAO,GAAK,IAAK,SAAS,OAAO;AAAA,IACjD,IAAI,MACJ;AAEN,UAAM,SACJ,iBAAiB,mBAAmB,SAAS,OAAO;AAEtD,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,UAAU,SAAS;AAAA,MACnB,cAAc,SAAS;AAAA,MACvB,cAAc,SAAS;AAAA,MACvB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,kBAAkB,SAAS,OAAO;AAAA,MAClC;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,YAA8B;AAC7C,UAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,QAAI,CAAC,SAAU,OAAM,IAAI,MAAM,oBAAoB;AAEnD,QAAI,SAAS,WAAW,UAAU;AAChC,YAAM,IAAI,MAAM,uCAAuC,SAAS,MAAM,EAAE;AAAA,IAC1E;AAEA,UAAM,MAAM,oBAAI,KAAK;AACrB,QAAI,OAAO,SAAS,SAAS;AAC3B,YAAM,IAAI,MAAM,yBAAyB;AAAA,IAC3C;AAEA,UAAM,SAAS,KAAK,gBAAgB,UAAU;AAC9C,aAAS,SAAS,OAAO,SAAS,WAAW;AAE7C,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,YAA8B;AAC5C,UAAM,WAAW,KAAK,UAAU,IAAI,UAAU;AAC9C,QAAI,CAAC,SAAU,OAAM,IAAI,MAAM,oBAAoB;AAEnD,QAAI,SAAS,WAAW,UAAU;AAChC,YAAM,IAAI,MAAM,sCAAsC,SAAS,MAAM,EAAE;AAAA,IACzE;AAEA,UAAM,MAAM,oBAAI,KAAK;AACrB,UAAM,gBAAgB,IAAI;AAAA,MACxB,SAAS,QAAQ,QAAQ,IAAI,SAAS,OAAO,wBAAwB;AAAA,IACvE;AAEA,QAAI,MAAM,eAAe;AACvB,YAAM,IAAI,MAAM,4BAA4B;AAAA,IAC9C;AAEA,aAAS,SAAS;AAClB,aAAS,aAAa;AAEtB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAqC;AACnC,UAAM,UAAsB,CAAC;AAC7B,UAAM,MAAM,oBAAI,KAAK;AAErB,eAAW,YAAY,KAAK,UAAU,OAAO,GAAG;AAC9C,UAAI,SAAS,WAAW,YAAY,MAAM,SAAS,SAAS;AAC1D,aAAK,iBAAiB,SAAS,EAAE;AACjC,gBAAQ,KAAK,QAAQ;AAAA,MACvB;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AACF;AASO,SAAS,uBACd,QACkB;AAClB,SAAO,IAAI,iBAAiB,MAAM;AACpC;","names":[]}