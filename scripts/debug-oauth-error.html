<!DOCTYPE html>
<html>
<head>
    <title>OAuth Error Debugger</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .error {
            background: #ff4444;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>OAuth Error Debugger</h1>
    <div id="output"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const output = document.getElementById('output');

        // Capture all URL parameters
        const params = {};
        for (const [key, value] of urlParams) {
            params[key] = value;
        }

        // Check for common OAuth error parameters
        const error = urlParams.get('error');
        const errorDescription = urlParams.get('error_description');
        const errorUri = urlParams.get('error_uri');
        const code = urlParams.get('code');
        const state = urlParams.get('state');

        let html = '<div class="info"><h2>Full URL:</h2><pre>' + window.location.href + '</pre></div>';

        if (error) {
            html += '<div class="error">';
            html += '<h2>❌ OAuth Error Detected</h2>';
            html += '<p><strong>Error:</strong> ' + error + '</p>';
            if (errorDescription) {
                html += '<p><strong>Description:</strong> ' + decodeURIComponent(errorDescription) + '</p>';
            }
            if (errorUri) {
                html += '<p><strong>URI:</strong> ' + errorUri + '</p>';
            }
            html += '</div>';

            // Common Discord OAuth errors
            html += '<div class="info"><h3>Common Causes:</h3><ul>';
            if (error === 'access_denied') {
                html += '<li>User clicked "Cancel" on Discord authorization</li>';
            } else if (error === 'invalid_request') {
                html += '<li>Missing or invalid parameters in OAuth request</li>';
                html += '<li>Check Discord OAuth app configuration</li>';
            } else if (error === 'unauthorized_client') {
                html += '<li>Discord Client ID is incorrect</li>';
                html += '<li>OAuth app not properly configured</li>';
            } else if (error === 'redirect_uri_mismatch') {
                html += '<li>Redirect URI in Discord app settings doesn\'t match</li>';
                html += '<li>Should be: https://api.b0ase.com/auth/v1/callback</li>';
            }
            html += '</ul></div>';
        } else if (code) {
            html += '<div class="info">';
            html += '<h2>✅ OAuth Code Received</h2>';
            html += '<p>Code: ' + code.substring(0, 20) + '...</p>';
            html += '<p>This means Discord OAuth succeeded, but something failed in the callback.</p>';
            html += '</div>';
        } else {
            html += '<div class="info">';
            html += '<h2>ℹ️ All URL Parameters:</h2>';
            html += '<pre>' + JSON.stringify(params, null, 2) + '</pre>';
            html += '</div>';
        }

        output.innerHTML = html;

        // Log to console too
        console.log('OAuth Debug Info:', {
            error,
            errorDescription,
            code: code ? code.substring(0, 20) + '...' : null,
            allParams: params
        });
    </script>
</body>
</html>
